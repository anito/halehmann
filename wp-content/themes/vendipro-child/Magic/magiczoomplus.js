window.MagicZoom=function(){function t(t){var e,i;for(e="",i=0;i<t.length;i++)e+=String.fromCharCode(14^t.charCodeAt(i));return e}function e(t){var e=[],i=null;return t&&(i=c(t))&&(e=C.filter(function(t){return t.placeholder===i})),e.length?e[0]:null}function i(t){var e=c(window).jGetSize(),i=c(window).jGetScroll();return t=t||0,{left:t,right:e.width-t,top:t,bottom:e.height-t,x:i.x,y:i.y}}function o(t){return t.pointerType&&("touch"===t.pointerType||t.pointerType===t.MSPOINTER_TYPE_TOUCH)||/touch/i.test(t.type)}function n(t){return t.pointerType?("touch"===t.pointerType||t.MSPOINTER_TYPE_TOUCH===t.pointerType)&&t.isPrimary:1===t.changedTouches.length&&(t.targetTouches.length?t.targetTouches[0].identifier===t.changedTouches[0].identifier:!0)}function s(t){return Object.assign({},t,{type:t.type,pageX:t.pageX,pageY:t.pageY,screenX:t.screenX,screenY:t.screenY,clientX:t.clientX,clientY:t.clientY})}function a(){var t=m.$A(arguments),e=t.shift(),i=y[e];if(i)for(var o=0;o<i.length;o++)i[o].apply(null,t)}function r(){var t,e,i=arguments[0],o=[];try{do e=i.tagName,/^[A-Za-z]*$/.test(e)&&((t=i.getAttribute("id"))&&/^[A-Za-z][-A-Za-z0-9_]*/.test(t)&&(e+="#"+t),o.push(e)),i=i.parentNode;while(i&&i!==document.documentElement);o=o.reverse(),m.addCSS(o.join(" ")+"> .mz-figure > img",{width:"100% !important;",transition:"none",transform:"none"},"mz-runtime-css",!0)}catch(n){}}function h(){var t=null,e=null,i=function(){window.scrollTo(document.body.scrollLeft,document.body.scrollTop),window.dispatchEvent(new Event("resize"))};return e=setInterval(function(){var e=90===window.orientation||-90===window.orientation,o=window.innerHeight,n=.85*(e?screen.availWidth:screen.availHeight);null!==t&&t!==!1||!(e&&n>o||!e&&n>o)?null!==t&&t!==!0||!(e&&o>n||!e&&o>n)||(t=!1,i()):(t=!0,i())},250)}function d(){m.addCSS(".magic-hidden-wrapper, .magic-temporary-img",{display:"block !important","min-height":"0 !important","min-width":"0 !important","max-height":"none !important","max-width":"none !important",width:"10px !important",height:"10px !important",position:"absolute !important",top:"-10000px !important",left:"0 !important",overflow:"hidden !important","-webkit-transform":"none !important",transform:"none !important","-webkit-transition":"none !important",transition:"none !important"},"magiczoom-reset-css"),m.addCSS(".magic-temporary-img img",{display:"inline-block !important",border:"0 !important",padding:"0 !important","min-height":"0 !important","min-width":"0 !important","max-height":"none !important","max-width":"none !important","-webkit-transform":"none !important",transform:"none !important","-webkit-transition":"none !important",transition:"none !important"},"magiczoom-reset-css"),m.browser.androidBrowser&&m.addCSS(".mobile-magic .mz-expand .mz-expand-bg",{display:"none !important"},"magiczoom-reset-css"),!m.browser.androidBrowser||"chrome"===m.browser.uaName&&44!==m.browser.uaVersion||m.addCSS(".mobile-magic .mz-zoom-window.mz-magnifier, .mobile-magic .mz-zoom-window.mz-magnifier:before",{"border-radius":"0 !important"},"magiczoom-reset-css")}var l,m;l=m=function(){function t(t){var e=t.charAt(0).toUpperCase()+t.slice(1);return t in d||"Webkit"+e in d||"Moz"+e in d||"ms"+e in d||"O"+e in d}function e(t){var e,i;return i=o.browser.webkit&&"filter"==t?!1:t in d,!i&&(e=o.browser.cssDomPrefix+t.charAt(0).toUpperCase()+t.slice(1),e in d)?e:t}var i={version:"v3.3-b5",UUID:0,storage:{},$uuid:function(t){return t.$J_UUID||(t.$J_UUID=++o.UUID)},getStorage:function(t){return o.storage[t]||(o.storage[t]={})},$F:function(){},$false:function(){return!1},$true:function(){return!0},stylesId:"mjs-"+Math.floor(Math.random()*(new Date).getTime()),defined:function(t){return void 0!=t},ifndef:function(t,e){return void 0!=t?t:e},exists:function(t){return!!t},jTypeOf:function(t){if(!o.defined(t))return!1;if(t.$J_TYPE)return t.$J_TYPE;if(t.nodeType){if(1==t.nodeType)return"element";if(3==t.nodeType)return"textnode"}if(t.length&&t.item)return"collection";if(t.length&&t.callee)return"arguments";if((t instanceof window.Object||t instanceof window.Function)&&t.constructor===o.Class)return"class";if(t instanceof window.Array)return"array";if(t instanceof window.Function)return"function";if(t instanceof window.String)return"string";if(o.browser.trident){if(o.defined(t.cancelBubble))return"event"}else if(t===window.event||t.constructor==window.Event||t.constructor==window.MouseEvent||t.constructor==window.UIEvent||t.constructor==window.KeyboardEvent||t.constructor==window.KeyEvent)return"event";return t instanceof window.Date?"date":t instanceof window.RegExp?"regexp":t===window?"window":t===document?"document":typeof t},extend:function(t,e){if(t instanceof window.Array||(t=[t]),!e)return t[0];for(var i=0,n=t.length;n>i;i++)if(o.defined(t))for(var s in e)if(Object.prototype.hasOwnProperty.call(e,s))try{t[i][s]=e[s]}catch(a){}return t[0]},implement:function(t,e){t instanceof window.Array||(t=[t]);for(var i=0,n=t.length;n>i;i++)if(o.defined(t[i])&&t[i].prototype)for(var s in e||{})t[i].prototype[s]||(t[i].prototype[s]=e[s]);return t[0]},nativize:function(t,e){if(!o.defined(t))return t;for(var i in e||{})t[i]||(t[i]=e[i]);return t},$try:function(){for(var t=0,e=arguments.length;e>t;t++)try{return arguments[t]()}catch(i){}return null},$A:function(t){if(!o.defined(t))return o.$([]);if(t.toArray)return o.$(t.toArray());if(t.item){for(var e=t.length||0,i=new Array(e);e--;)i[e]=t[e];return o.$(i)}return o.$(Array.prototype.slice.call(t))},now:function(){return(new Date).getTime()},detach:function(t){var e;switch(o.jTypeOf(t)){case"object":e={};for(var i in t)e[i]=o.detach(t[i]);break;case"array":e=[];for(var n=0,s=t.length;s>n;n++)e[n]=o.detach(t[n]);break;default:return t}return o.$(e)},$:function(t){var e=!0;if(!o.defined(t))return null;if(t.$J_EXT)return t;switch(o.jTypeOf(t)){case"array":return t=o.nativize(t,o.extend(o.Array,{$J_EXT:o.$F})),t.jEach=t.forEach,t;case"string":var i=document.getElementById(t);return o.defined(i)?o.$(i):null;case"window":case"document":o.$uuid(t),t=o.extend(t,o.Doc);break;case"element":o.$uuid(t),t=o.extend(t,o.Element);break;case"event":t=o.extend(t,o.Event);break;case"textnode":case"function":case"array":case"date":default:e=!1}return e?o.extend(t,{$J_EXT:o.$F}):t},$new:function(t,e,i){return o.$(o.doc.createElement(t)).setProps(e||{}).jSetCss(i||{})},addCSS:function(t,e,i){var n,s,a,r=[],h=-1;if(i||(i=o.stylesId),n=o.$(i)||o.$new("style",{id:i,type:"text/css"}).jAppendTo(document.head||document.body,"top"),s=n.sheet||n.styleSheet,"string"!=o.jTypeOf(e)){for(var a in e)r.push(a+":"+e[a]);e=r.join(";")}return h=s.insertRule?s.insertRule(t+" {"+e+"}",s.cssRules.length):s.addRule(t,e)},removeCSS:function(t,e){var i,n;i=o.$(t),"element"===o.jTypeOf(i)&&(n=i.sheet||i.styleSheet,n.deleteRule?n.deleteRule(e):n.removeRule&&n.removeRule(e))},generateUUID:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0,i="x"==t?e:3&e|8;return i.toString(16)}).toUpperCase()},getAbsoluteURL:function(){var t;return function(e){return t||(t=document.createElement("a")),t.setAttribute("href",e),("!!"+t.href).replace("!!","")}}(),getHashCode:function(t){for(var e=0,i=t.length,o=0;i>o;++o)e=31*e+t.charCodeAt(o),e%=4294967296;return e}},o=i;i.$;window.magicJS||(window.magicJS=i,window.$mjs=i.$),o.Array={$J_TYPE:"array",indexOf:function(t,e){for(var i=(this.length,this.length),o=0>e?Math.max(0,i+e):e||0;i>o;o++)if(this[o]===t)return o;return-1},contains:function(t,e){return-1!=this.indexOf(t,e)},forEach:function(t,e){for(var i=0,o=this.length;o>i;i++)i in this&&t.call(e,this[i],i,this)},filter:function(t,e){for(var i=[],o=0,n=this.length;n>o;o++)if(o in this){var s=this[o];t.call(e,this[o],o,this)&&i.push(s)}return i},map:function(t,e){for(var i=[],o=0,n=this.length;n>o;o++)o in this&&(i[o]=t.call(e,this[o],o,this));return i}},o.implement(String,{$J_TYPE:"string",jTrim:function(){return this.replace(/^\s+|\s+$/g,"")},eq:function(t,e){return e?this.toString()===t.toString():this.toLowerCase().toString()===t.toLowerCase().toString()},jCamelize:function(){return this.replace(/-\D/g,function(t){return t.charAt(1).toUpperCase()})},dashize:function(){return this.replace(/[A-Z]/g,function(t){return"-"+t.charAt(0).toLowerCase()})},jToInt:function(t){return parseInt(this,t||10)},toFloat:function(){return parseFloat(this)},jToBool:function(){return!this.replace(/true/i,"").jTrim()},has:function(t,e){return e=e||"",(e+this+e).indexOf(e+t+e)>-1}}),i.implement(Function,{$J_TYPE:"function",jBind:function(){var t=o.$A(arguments),e=this,i=t.shift();return function(){return e.apply(i||null,t.concat(o.$A(arguments)))}},jBindAsEvent:function(){var t=o.$A(arguments),e=this,i=t.shift();return function(n){return e.apply(i||null,o.$([n||(o.browser.ieMode?window.event:null)]).concat(t))}},jDelay:function(){var t=o.$A(arguments),e=this,i=t.shift();return window.setTimeout(function(){return e.apply(e,t)},i||0)},jDefer:function(){var t=o.$A(arguments),e=this;return function(){return e.jDelay.apply(e,t)}},interval:function(){var t=o.$A(arguments),e=this,i=t.shift();return window.setInterval(function(){return e.apply(e,t)},i||0)}});var n={},s=navigator.userAgent.toLowerCase(),a=s.match(/(webkit|gecko|trident|presto)\/(\d+\.?\d*)/i),r=s.match(/(edge|opr)\/(\d+\.?\d*)/i)||s.match(/(crios|chrome|safari|firefox|opera|opr)\/(\d+\.?\d*)/i),h=s.match(/version\/(\d+\.?\d*)/i),d=document.documentElement.style;o.browser={features:{xpath:!!document.evaluate,air:!!window.runtime,query:!!document.querySelector,fullScreen:!!(document.fullscreenEnabled||document.msFullscreenEnabled||document.exitFullscreen||document.cancelFullScreen||document.webkitexitFullscreen||document.webkitCancelFullScreen||document.mozCancelFullScreen||document.oCancelFullScreen||document.msCancelFullScreen),xhr2:!!window.ProgressEvent&&!!window.FormData&&window.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest,transition:t("transition"),transform:t("transform"),perspective:t("perspective"),animation:t("animation"),requestAnimationFrame:!1,multibackground:!1,cssFilters:!1,canvas:!1,svg:function(){return document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#Image","1.1")}()},touchScreen:function(){return"ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0}(),mobile:s.match(/(android|bb\d+|meego).+|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od|ad)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/)?!0:!1,engine:a&&a[1]?a[1].toLowerCase():window.opera?"presto":window.ActiveXObject?"trident":void 0!==document.getBoxObjectFor||null!=window.mozInnerScreenY?"gecko":null===window.WebKitPoint&&navigator.taintEnabled?"unknown":"webkit",version:a&&a[2]?parseFloat(a[2]):0,uaName:r&&r[1]?r[1].toLowerCase():"",uaVersion:r&&r[2]?parseFloat(r[2]):0,cssPrefix:"",cssDomPrefix:"",domPrefix:"",ieMode:0,platform:s.match(/ip(?:ad|od|hone)/)?"ios":(s.match(/(?:webos|android)/)||navigator.platform.match(/mac|win|linux/i)||["other"])[0].toLowerCase(),backCompat:document.compatMode&&"backcompat"==document.compatMode.toLowerCase(),scrollbarsWidth:0,getDoc:function(){return document.compatMode&&"backcompat"==document.compatMode.toLowerCase()?document.body:document.documentElement},requestAnimationFrame:window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||void 0,cancelAnimationFrame:window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.mozCancelAnimationFrame||window.oCancelAnimationFrame||window.msCancelAnimationFrame||window.webkitCancelRequestAnimationFrame||void 0,ready:!1,onready:function(){if(!o.browser.ready){var t,e;o.browser.ready=!0,o.body=o.$(document.body),o.win=o.$(window);try{var i=o.$new("div").jSetCss({width:100,height:100,overflow:"scroll",position:"absolute",top:-9999}).jAppendTo(document.body);o.browser.scrollbarsWidth=i.offsetWidth-i.clientWidth,i.jRemove()}catch(s){}try{t=o.$new("div"),e=t.style,e.cssText="background:url(https://),url(https://),red url(https://)",o.browser.features.multibackground=/(url\s*\(.*?){3}/.test(e.background),e=null,t=null}catch(s){}o.browser.cssTransformProp||(o.browser.cssTransformProp=o.normalizeCSS("transform").dashize());try{t=o.$new("div"),t.style.cssText=o.normalizeCSS("filter").dashize()+":blur(2px);",o.browser.features.cssFilters=!!t.style.length&&(!o.browser.ieMode||o.browser.ieMode>9),t=null}catch(s){}o.browser.features.cssFilters||o.$(document.documentElement).jAddClass("no-cssfilters-magic");try{o.browser.features.canvas=function(){var t=o.$new("canvas");return!(!t.getContext||!t.getContext("2d"))}()}catch(s){}void 0===window.TransitionEvent&&void 0!==window.WebKitTransitionEvent&&(n.transitionend="webkitTransitionEnd"),o.Doc.jCallEvent.call(o.$(document),"domready")}}},function(){var t,e,i,n=[];switch(o.browser.engine){case"trident":o.browser.version||(o.browser.version=window.XMLHttpRequest?3:2);break;case"gecko":o.browser.version=r&&r[2]?parseFloat(r[2]):0}if(o.browser[o.browser.engine]=!0,r&&"crios"===r[1]&&(o.browser.uaName="chrome"),window.chrome&&(o.browser.chrome=!0),r&&"opr"===r[1]&&(o.browser.uaName="opera",o.browser.opera=!0),"safari"===o.browser.uaName&&h&&h[1]&&(o.browser.uaVersion=parseFloat(h[1])),"android"==o.browser.platform&&o.browser.webkit&&h&&h[1]&&(o.browser.androidBrowser=!0),t={gecko:["-moz-","Moz","moz"],webkit:["-webkit-","Webkit","webkit"],trident:["-ms-","ms","ms"],presto:["-o-","O","o"]}[o.browser.engine]||["","",""],o.browser.cssPrefix=t[0],o.browser.cssDomPrefix=t[1],o.browser.domPrefix=t[2],o.browser.ieMode=o.browser.trident?document.documentMode?document.documentMode:function(){var t=0;if(o.browser.backCompat)return 5;switch(o.browser.version){case 2:t=6;break;case 3:t=7}return t}():void 0,n.push(o.browser.platform+"-magic"),o.browser.mobile&&n.push("mobile-magic"),o.browser.androidBrowser&&n.push("android-browser-magic"),o.browser.ieMode)for(o.browser.uaName="ie",o.browser.uaVersion=o.browser.ieMode,n.push("ie"+o.browser.ieMode+"-magic"),e=11;e>o.browser.ieMode;e--)n.push("lt-ie"+e+"-magic");o.browser.webkit&&o.browser.version<536&&(o.browser.features.fullScreen=!1),o.browser.requestAnimationFrame&&o.browser.requestAnimationFrame.call(window,function(){o.browser.features.requestAnimationFrame=!0}),o.browser.features.svg?n.push("svg-magic"):n.push("no-svg-magic"),i=(document.documentElement.className||"").match(/\S+/g)||[],document.documentElement.className=o.$(i).concat(n).join(" ");try{document.documentElement.setAttribute("data-magic-ua",o.browser.uaName),document.documentElement.setAttribute("data-magic-ua-ver",o.browser.uaVersion)}catch(s){}o.browser.ieMode&&o.browser.ieMode<9&&(document.createElement("figure"),document.createElement("figcaption"))}(),function(){o.browser.fullScreen={capable:o.browser.features.fullScreen,enabled:function(){return!!(document.fullscreenElement||document[o.browser.domPrefix+"FullscreenElement"]||document.fullScreen||document.webkitIsFullScreen||document[o.browser.domPrefix+"FullScreen"])},request:function(t,e){e||(e={}),this.capable?(o.$(document).jAddEvent(this.changeEventName,this.onchange=function(t){this.enabled()?e.onEnter&&e.onEnter():(o.$(document).jRemoveEvent(this.changeEventName,this.onchange),e.onExit&&e.onExit())}.jBindAsEvent(this)),o.$(document).jAddEvent(this.errorEventName,this.onerror=function(t){e.fallback&&e.fallback(),o.$(document).jRemoveEvent(this.errorEventName,this.onerror)}.jBindAsEvent(this)),(t[o.browser.domPrefix+"RequestFullscreen"]||t[o.browser.domPrefix+"RequestFullScreen"]||t.requestFullscreen||function(){}).call(t)):e.fallback&&e.fallback()},cancel:(document.exitFullscreen||document.cancelFullScreen||document[o.browser.domPrefix+"ExitFullscreen"]||document[o.browser.domPrefix+"CancelFullScreen"]||function(){}).jBind(document),changeEventName:document.msExitFullscreen?"MSFullscreenChange":(document.exitFullscreen?"":o.browser.domPrefix)+"fullscreenchange",errorEventName:document.msExitFullscreen?"MSFullscreenError":(document.exitFullscreen?"":o.browser.domPrefix)+"fullscreenerror",prefix:o.browser.domPrefix,activeElement:null}}();var l=/\S+/g,m=/^(border(Top|Bottom|Left|Right)Width)|((padding|margin)(Top|Bottom|Left|Right))$/,u={"float":"undefined"==typeof d.styleFloat?"cssFloat":"styleFloat"},c={fontWeight:!0,lineHeight:!0,opacity:!0,zIndex:!0,zoom:!0},p=window.getComputedStyle?function(t,e){var i=window.getComputedStyle(t,null);return i?i.getPropertyValue(e)||i[e]:null}:function(t,e){var i=t.currentStyle,o=null;return o=i?i[e]:null,null==o&&t.style&&t.style[e]&&(o=t.style[e]),o};return o.normalizeCSS=e,o.Element={jHasClass:function(t){return!(t||"").has(" ")&&(this.className||"").has(t," ")},jAddClass:function(t){for(var e=(this.className||"").match(l)||[],i=(t||"").match(l)||[],n=i.length,s=0;n>s;s++)o.$(e).contains(i[s])||e.push(i[s]);return this.className=e.join(" "),this},jRemoveClass:function(t){for(var e,i=(this.className||"").match(l)||[],n=(t||"").match(l)||[],s=n.length,a=0;s>a;a++)(e=o.$(i).indexOf(n[a]))>-1&&i.splice(e,1);return this.className=t?i.join(" "):"",this},jToggleClass:function(t){return this.jHasClass(t)?this.jRemoveClass(t):this.jAddClass(t)},jGetCss:function(t){var i=t.jCamelize(),n=null;if(t=u[i]||(u[i]=e(i)),n=p(this,t),"auto"===n&&(n=null),null!==n){if("opacity"==t)return o.defined(n)?parseFloat(n):1;m.test(t)&&(n=parseInt(n,10)?n:"0px")}return n},jSetCssProp:function(t,i){var n=t.jCamelize();try{if("opacity"==t)return this.jSetOpacity(i),this;t=u[n]||(u[n]=e(n)),this.style[t]=i+("number"!=o.jTypeOf(i)||c[n]?"":"px")}catch(s){}return this},jSetCss:function(t){for(var e in t)this.jSetCssProp(e,t[e]);return this},jGetStyles:function(){var t={};return o.$A(arguments).jEach(function(e){t[e]=this.jGetCss(e)},this),t},jSetOpacity:function(t,e){return e=e||!1,this.style.opacity=t,t=parseInt(100*parseFloat(t)),e&&(0===t?"hidden"!=this.style.visibility&&(this.style.visibility="hidden"):"visible"!=this.style.visibility&&(this.style.visibility="visible")),o.browser.ieMode&&o.browser.ieMode<9&&(isNaN(t)?(this.style.filter=this.style.filter.replace(/progid:DXImageTransform.Microsoft.Alpha\(Opacity=\d*\)/i,"").jTrim(),""===this.style.filter&&this.style.removeAttribute("filter")):~this.style.filter.indexOf("Alpha")?this.style.filter=this.style.filter.replace(/Opacity=\d*/i,"Opacity="+t):this.style.filter+=" progid:DXImageTransform.Microsoft.Alpha(Opacity="+t+")"),this},setProps:function(t){for(var e in t)"class"===e?this.jAddClass(""+t[e]):this.setAttribute(e,""+t[e]);return this},jGetTransitionDuration:function(){var t=0,e=0;return t=this.jGetCss("transition-duration"),e=this.jGetCss("transition-delay"),t=t.indexOf("ms")>-1?parseFloat(t):t.indexOf("s")>-1?1e3*parseFloat(t):0,e=e.indexOf("ms")>-1?parseFloat(e):e.indexOf("s")>-1?1e3*parseFloat(e):0,t+e},hide:function(){return this.jSetCss({display:"none",visibility:"hidden"})},show:function(){return this.jSetCss({display:"",visibility:"visible"})},jGetSize:function(){return{width:this.offsetWidth,height:this.offsetHeight}},getInnerSize:function(t){var e=this.jGetSize();return e.width-=parseFloat(this.jGetCss("border-left-width")||0)+parseFloat(this.jGetCss("border-right-width")||0),e.height-=parseFloat(this.jGetCss("border-top-width")||0)+parseFloat(this.jGetCss("border-bottom-width")||0),t||(e.width-=parseFloat(this.jGetCss("padding-left")||0)+parseFloat(this.jGetCss("padding-right")||0),e.height-=parseFloat(this.jGetCss("padding-top")||0)+parseFloat(this.jGetCss("padding-bottom")||0)),e},jGetScroll:function(){return{top:this.scrollTop,left:this.scrollLeft}},jGetFullScroll:function(){var t=this,e={top:0,left:0};do e.left+=t.scrollLeft||0,e.top+=t.scrollTop||0,t=t.parentNode;while(t);return e},jGetPosition:function(){var t=this,e=0,i=0;if(o.defined(document.documentElement.getBoundingClientRect)){var n=this.getBoundingClientRect(),s=o.$(document).jGetScroll(),a=o.browser.getDoc();return{top:n.top+s.y-a.clientTop,left:n.left+s.x-a.clientLeft}}do e+=t.offsetLeft||0,i+=t.offsetTop||0,t=t.offsetParent;while(t&&!/^(?:body|html)$/i.test(t.tagName));return{top:i,left:e}},jGetRect:function(){var t=this.jGetPosition(),e=this.jGetSize();return{top:t.top,bottom:t.top+e.height,left:t.left,right:t.left+e.width}},changeContent:function(t){try{this.innerHTML=t}catch(e){this.innerText=t}return this},jRemove:function(){return this.parentNode?this.parentNode.removeChild(this):this},kill:function(){return o.$A(this.childNodes).jEach(function(t){3!=t.nodeType&&8!=t.nodeType&&o.$(t).kill()}),this.jRemove(),this.jClearEvents(),this.$J_UUID&&(o.storage[this.$J_UUID]=null,delete o.storage[this.$J_UUID]),null},append:function(t,e){e=e||"bottom";var i=this.firstChild;return"top"==e&&i?this.insertBefore(t,i):this.appendChild(t),this},jAppendTo:function(t,e){o.$(t).append(this,e);return this},enclose:function(t){return this.append(t.parentNode.replaceChild(this,t)),this},hasChild:function(t){return"element"!==o.jTypeOf("string"==o.jTypeOf(t)?t=document.getElementById(t):t)?!1:this==t?!1:this.contains&&!o.browser.webkit419?this.contains(t):this.compareDocumentPosition?!!(16&this.compareDocumentPosition(t)):o.$A(this.byTag(t.tagName)).contains(t)}},o.Element.jGetStyle=o.Element.jGetCss,o.Element.jSetStyle=o.Element.jSetCss,window.Element||(window.Element=o.$F,o.browser.engine.webkit&&window.document.createElement("iframe"),window.Element.prototype=o.browser.engine.webkit?window["[[DOMElement.prototype]]"]:{}),o.implement(window.Element,{$J_TYPE:"element"}),o.Doc={jGetSize:function(){return o.browser.touchScreen||o.browser.presto925||o.browser.webkit419?{width:window.innerWidth,height:window.innerHeight}:{width:o.browser.getDoc().clientWidth,height:o.browser.getDoc().clientHeight}},jGetScroll:function(){return{x:window.pageXOffset||o.browser.getDoc().scrollLeft,y:window.pageYOffset||o.browser.getDoc().scrollTop}},jGetFullSize:function(){var t=this.jGetSize();return{width:Math.max(o.browser.getDoc().scrollWidth,t.width),height:Math.max(o.browser.getDoc().scrollHeight,t.height)}}},o.extend(document,{$J_TYPE:"document"}),o.extend(window,{$J_TYPE:"window"}),o.extend([o.Element,o.Doc],{jFetch:function(t,e){var i=o.getStorage(this.$J_UUID),n=i[t];return void 0!==e&&void 0===n&&(n=i[t]=e),o.defined(n)?n:null},jStore:function(t,e){var i=o.getStorage(this.$J_UUID);return i[t]=e,this},jDel:function(t){var e=o.getStorage(this.$J_UUID);return delete e[t],this}}),window.HTMLElement&&window.HTMLElement.prototype&&window.HTMLElement.prototype.getElementsByClassName||o.extend([o.Element,o.Doc],{getElementsByClassName:function(t){return o.$A(this.getElementsByTagName("*")).filter(function(e){try{return 1==e.nodeType&&e.className.has(t," ")}catch(i){}})}}),o.extend([o.Element,o.Doc],{byClass:function(){return this.getElementsByClassName(arguments[0])},byTag:function(){return this.getElementsByTagName(arguments[0])}}),o.browser.fullScreen.capable&&!document.requestFullScreen&&(o.Element.requestFullScreen=function(){o.browser.fullScreen.request(this)}),o.Event={$J_TYPE:"event",isQueueStopped:o.$false,stop:function(){return this.stopDistribution().stopDefaults()},stopDistribution:function(){return this.stopPropagation?this.stopPropagation():this.cancelBubble=!0,this},stopDefaults:function(){return this.preventDefault?this.preventDefault():this.returnValue=!1,this},stopQueue:function(){return this.isQueueStopped=o.$true,this},getClientXY:function(){var t;return t=/touch/i.test(this.type)?this.changedTouches[0]:this,o.defined(t)?{x:t.clientX,y:t.clientY}:{x:0,y:0}},jGetPageXY:function(){var t;return t=/touch/i.test(this.type)?this.changedTouches[0]:this,o.defined(t)?{x:t.pageX||t.clientX+o.browser.getDoc().scrollLeft,y:t.pageY||t.clientY+o.browser.getDoc().scrollTop}:{x:0,y:0}},getTarget:function(){for(var t=this.target||this.srcElement;t&&3==t.nodeType;)t=t.parentNode;return t},getRelated:function(){var t=null;switch(this.type){case"mouseover":case"pointerover":case"MSPointerOver":t=this.relatedTarget||this.fromElement;break;case"mouseout":case"pointerout":case"MSPointerOut":t=this.relatedTarget||this.toElement;break;default:return t}try{for(;t&&3==t.nodeType;)t=t.parentNode}catch(e){t=null}return t},getButton:function(){return this.which||void 0===this.button?this.which:1&this.button?1:2&this.button?3:4&this.button?2:0},isTouchEvent:function(){return this.pointerType&&("touch"===this.pointerType||this.pointerType===this.MSPOINTER_TYPE_TOUCH)||/touch/i.test(this.type)},isPrimaryTouch:function(){return this.pointerType?("touch"===this.pointerType||this.MSPOINTER_TYPE_TOUCH===this.pointerType)&&this.isPrimary:1===this.changedTouches.length&&(this.targetTouches.length?this.targetTouches[0].identifier==this.changedTouches[0].identifier:!0)}},o._event_add_="addEventListener",o._event_del_="removeEventListener",o._event_prefix_="",document.addEventListener||(o._event_add_="attachEvent",o._event_del_="detachEvent",o._event_prefix_="on"),o.Event.Custom={type:"",x:null,y:null,timeStamp:null,button:null,target:null,relatedTarget:null,$J_TYPE:"event.custom",isQueueStopped:o.$false,events:o.$([]),pushToEvents:function(t){var e=t;this.events.push(e)},stop:function(){return this.stopDistribution().stopDefaults()},stopDistribution:function(){return this.events.jEach(function(t){try{t.stopDistribution()}catch(e){}}),this},stopDefaults:function(){return this.events.jEach(function(t){try{t.stopDefaults()}catch(e){}}),this},stopQueue:function(){return this.isQueueStopped=o.$true,this},getClientXY:function(){return{x:this.clientX,y:this.clientY}},jGetPageXY:function(){return{x:this.x,y:this.y}},getTarget:function(){return this.target},getRelated:function(){return this.relatedTarget},getButton:function(){return this.button},getOriginalTarget:function(){return this.events.length>0?this.events[0].getTarget():void 0}},o.extend([o.Element,o.Doc],{jAddEvent:function(t,e,i,s){var a,r,h,d,l;return"string"==o.jTypeOf(t)&&(l=t.split(" "),l.length>1&&(t=l)),"array"==o.jTypeOf(t)?(o.$(t).jEach(this.jAddEvent.jBindAsEvent(this,e,i,s)),this):t&&e&&"string"==o.jTypeOf(t)&&"function"==o.jTypeOf(e)?"domready"==t&&o.browser.ready?(e.call(this),this):(t=n[t]||t,i=parseInt(i||50),e.$J_EUID||(e.$J_EUID=Math.floor(Math.random()*o.now())),a=o.Doc.jFetch.call(this,"_EVENTS_",{}),r=a[t],r||(a[t]=r=o.$([]),h=this,o.Event.Custom[t]?o.Event.Custom[t].handler.add.call(this,s):(r.handle=function(e){e=o.extend(e||window.e,{$J_TYPE:"event"}),o.Doc.jCallEvent.call(h,t,o.$(e))},this[o._event_add_](o._event_prefix_+t,r.handle,!1))),d={type:t,fn:e,priority:i,euid:e.$J_EUID},r.push(d),r.sort(function(t,e){return t.priority-e.priority}),this):this},jRemoveEvent:function(t){var e,i,s,a,r,h,d=o.Doc.jFetch.call(this,"_EVENTS_",{});if(r=arguments.length>1?arguments[1]:-100,"string"==o.jTypeOf(t)&&(h=t.split(" "),h.length>1&&(t=h)),"array"==o.jTypeOf(t))return o.$(t).jEach(this.jRemoveEvent.jBindAsEvent(this,r)),this;if(t=n[t]||t,!t||"string"!=o.jTypeOf(t)||!d||!d[t])return this;for(e=d[t]||[],s=0;s<e.length;s++)i=e[s],(-100==r||r&&r.$J_EUID===i.euid)&&(a=e.splice(s--,1));return 0===e.length&&(o.Event.Custom[t]?o.Event.Custom[t].handler.jRemove.call(this):this[o._event_del_](o._event_prefix_+t,e.handle,!1),delete d[t]),this},jCallEvent:function(t,e){var i,s,a=o.Doc.jFetch.call(this,"_EVENTS_",{});if(t=n[t]||t,!t||"string"!=o.jTypeOf(t)||!a||!a[t])return this;try{e=o.extend(e||{},{type:t})}catch(r){}for(void 0===e.timeStamp&&(e.timeStamp=o.now()),i=a[t]||[],s=0;s<i.length&&(!e.isQueueStopped||!e.isQueueStopped());s++)i[s].fn.call(this,e)},jRaiseEvent:function(t,e){var i,s="domready"==t?!1:!0,a=this;return t=n[t]||t,s?(a===document&&document.createEvent&&!a.dispatchEvent&&(a=document.documentElement),document.createEvent?(i=document.createEvent(t),i.initEvent(e,!0,!0)):(i=document.createEventObject(),i.eventType=t),document.createEvent?a.dispatchEvent(i):a.fireEvent("on"+e,i),i):(o.Doc.jCallEvent.call(this,t),this)},jClearEvents:function(){var t=o.Doc.jFetch.call(this,"_EVENTS_");if(!t)return this;for(var e in t)o.Doc.jRemoveEvent.call(this,e);return o.Doc.jDel.call(this,"_EVENTS_"),this}}),function(t){return"complete"===document.readyState?t.browser.onready.jDelay(1):void(t.browser.webkit&&t.browser.version<420?!function(){t.$(["loaded","complete"]).contains(document.readyState)?t.browser.onready():arguments.callee.jDelay(50)}():t.browser.trident&&t.browser.ieMode<9&&window==top?!function(){t.$try(function(){return t.browser.getDoc().doScroll("left"),!0})?t.browser.onready():arguments.callee.jDelay(50)}():(t.Doc.jAddEvent.call(t.$(document),"DOMContentLoaded",t.browser.onready),t.Doc.jAddEvent.call(t.$(window),"load",t.browser.onready)))}(i),o.Class=function(){var t=null,e=o.$A(arguments);"class"==o.jTypeOf(e[0])&&(t=e.shift());var i=function(){for(var t in this)this[t]=o.detach(this[t]);if(this.constructor.$parent){this.$parent={};var e=this.constructor.$parent;for(var i in e){var n=e[i];switch(o.jTypeOf(n)){case"function":this.$parent[i]=o.Class.wrap(this,n);break;case"object":this.$parent[i]=o.detach(n);break;case"array":this.$parent[i]=o.detach(n)}}}var s=this.init?this.init.apply(this,arguments):this;return delete this.caller,s};if(i.prototype.init||(i.prototype.init=o.$F),t){var n=function(){};n.prototype=t.prototype,i.prototype=new n,i.$parent={};for(var s in t.prototype)i.$parent[s]=t.prototype[s]}else i.$parent=null;return i.constructor=o.Class,i.prototype.constructor=i,o.extend(i.prototype,e[0]),o.extend(i,{$J_TYPE:"class"}),i},i.Class.wrap=function(t,e){return function(){var i=(this.caller,e.apply(t,arguments));return i}},function(t){var e=(t.$,5),i=300;t.Event.Custom.btnclick=new t.Class(t.extend(t.Event.Custom,{type:"btnclick",init:function(t,e){var i=e.jGetPageXY();this.x=i.x,this.y=i.y,this.clientX=e.clientX,this.clientY=e.clientY,this.timeStamp=e.timeStamp,this.button=e.getButton(),this.target=t,this.pushToEvents(e)}})),t.Event.Custom.btnclick.handler={options:{threshold:i,button:1},add:function(e){this.jStore("event:btnclick:options",t.extend(t.detach(t.Event.Custom.btnclick.handler.options),e||{})),this.jAddEvent("mousedown",t.Event.Custom.btnclick.handler.handle,1),this.jAddEvent("mouseup",t.Event.Custom.btnclick.handler.handle,1),this.jAddEvent("click",t.Event.Custom.btnclick.handler.onclick,1),t.browser.trident&&t.browser.ieMode<9&&this.jAddEvent("dblclick",t.Event.Custom.btnclick.handler.handle,1)},jRemove:function(){this.jRemoveEvent("mousedown",t.Event.Custom.btnclick.handler.handle),this.jRemoveEvent("mouseup",t.Event.Custom.btnclick.handler.handle),this.jRemoveEvent("click",t.Event.Custom.btnclick.handler.onclick),t.browser.trident&&t.browser.ieMode<9&&this.jRemoveEvent("dblclick",t.Event.Custom.btnclick.handler.handle)},onclick:function(t){t.stopDefaults()},handle:function(i){var o,n,s;if(n=this.jFetch("event:btnclick:options"),"dblclick"==i.type||i.getButton()==n.button){if(this.jFetch("event:btnclick:ignore"))return void this.jDel("event:btnclick:ignore");if("mousedown"==i.type)o=new t.Event.Custom.btnclick(this,i),this.jStore("event:btnclick:btnclickEvent",o);else if("mouseup"==i.type){if(o=this.jFetch("event:btnclick:btnclickEvent"),!o)return;s=i.jGetPageXY(),this.jDel("event:btnclick:btnclickEvent"),o.pushToEvents(i),i.timeStamp-o.timeStamp<=n.threshold&&Math.sqrt(Math.pow(s.x-o.x,2)+Math.pow(s.y-o.y,2))<=e&&this.jCallEvent("btnclick",o),document.jCallEvent("mouseup",i)}else"dblclick"==i.type&&(o=new t.Event.Custom.btnclick(this,i),this.jCallEvent("btnclick",o))}}}}(i),function(t){var e=t.$;t.Event.Custom.mousedrag=new t.Class(t.extend(t.Event.Custom,{type:"mousedrag",state:"dragstart",dragged:!1,init:function(t,e,i){var o=e.jGetPageXY();this.x=o.x,this.y=o.y,this.clientX=e.clientX,this.clientY=e.clientY,this.timeStamp=e.timeStamp,
this.button=e.getButton(),this.target=t,this.pushToEvents(e),this.state=i}})),t.Event.Custom.mousedrag.handler={add:function(){var e=t.Event.Custom.mousedrag.handler.handleMouseMove.jBindAsEvent(this),i=t.Event.Custom.mousedrag.handler.handleMouseUp.jBindAsEvent(this);this.jAddEvent("mousedown",t.Event.Custom.mousedrag.handler.handleMouseDown,1),this.jAddEvent("mouseup",t.Event.Custom.mousedrag.handler.handleMouseUp,1),document.jAddEvent("mousemove",e,1),document.jAddEvent("mouseup",i,1),this.jStore("event:mousedrag:listeners:document:move",e),this.jStore("event:mousedrag:listeners:document:end",i)},jRemove:function(){this.jRemoveEvent("mousedown",t.Event.Custom.mousedrag.handler.handleMouseDown),this.jRemoveEvent("mouseup",t.Event.Custom.mousedrag.handler.handleMouseUp),e(document).jRemoveEvent("mousemove",this.jFetch("event:mousedrag:listeners:document:move")||t.$F),e(document).jRemoveEvent("mouseup",this.jFetch("event:mousedrag:listeners:document:end")||t.$F),this.jDel("event:mousedrag:listeners:document:move"),this.jDel("event:mousedrag:listeners:document:end")},handleMouseDown:function(e){var i;1==e.getButton()&&(i=new t.Event.Custom.mousedrag(this,e,"dragstart"),this.jStore("event:mousedrag:dragstart",i))},handleMouseUp:function(e){var i;i=this.jFetch("event:mousedrag:dragstart"),i&&(e.stopDefaults(),i=new t.Event.Custom.mousedrag(this,e,"dragend"),this.jDel("event:mousedrag:dragstart"),this.jCallEvent("mousedrag",i))},handleMouseMove:function(e){var i;i=this.jFetch("event:mousedrag:dragstart"),i&&(e.stopDefaults(),i.dragged||(i.dragged=!0,this.jCallEvent("mousedrag",i)),i=new t.Event.Custom.mousedrag(this,e,"dragmove"),this.jCallEvent("mousedrag",i))}}}(i),function(t){t.$;t.Event.Custom.dblbtnclick=new t.Class(t.extend(t.Event.Custom,{type:"dblbtnclick",timedout:!1,tm:null,init:function(t,e){var i=e.jGetPageXY();this.x=i.x,this.y=i.y,this.clientX=e.clientX,this.clientY=e.clientY,this.timeStamp=e.timeStamp,this.button=e.getButton(),this.target=t,this.pushToEvents(e)}})),t.Event.Custom.dblbtnclick.handler={options:{threshold:200},add:function(e){this.jStore("event:dblbtnclick:options",t.extend(t.detach(t.Event.Custom.dblbtnclick.handler.options),e||{})),this.jAddEvent("btnclick",t.Event.Custom.dblbtnclick.handler.handle,1)},jRemove:function(){this.jRemoveEvent("btnclick",t.Event.Custom.dblbtnclick.handler.handle)},handle:function(e){var i,o;i=this.jFetch("event:dblbtnclick:event"),o=this.jFetch("event:dblbtnclick:options"),i?(clearTimeout(i.tm),this.jDel("event:dblbtnclick:event"),i.timedout||(i.pushToEvents(e),e.stopQueue().stop(),this.jCallEvent("dblbtnclick",i))):(i=new t.Event.Custom.dblbtnclick(this,e),i.tm=setTimeout(function(){i.timedout=!0,e.isQueueStopped=t.$false,this.jCallEvent("btnclick",e),this.jDel("event:dblbtnclick:event")}.jBind(this),o.threshold+10),this.jStore("event:dblbtnclick:event",i),e.stopQueue())}}}(i),function(t){function e(t){return t.pointerType?("touch"===t.pointerType||t.MSPOINTER_TYPE_TOUCH===t.pointerType)&&t.isPrimary:1===t.changedTouches.length&&(t.targetTouches.length?t.targetTouches[0].identifier==t.changedTouches[0].identifier:!0)}function i(t){return t.pointerType?"touch"===t.pointerType||t.MSPOINTER_TYPE_TOUCH===t.pointerType?t.pointerId:null:t.changedTouches[0].identifier}function o(t){return t.pointerType?"touch"===t.pointerType||t.MSPOINTER_TYPE_TOUCH===t.pointerType?t:null:t.changedTouches[0]}t.$;t.Event.Custom.tap=new t.Class(t.extend(t.Event.Custom,{type:"tap",id:null,init:function(t,e){var i=o(e);this.id=i.pointerId||i.identifier,this.x=i.pageX,this.y=i.pageY,this.pageX=i.pageX,this.pageY=i.pageY,this.clientX=i.clientX,this.clientY=i.clientY,this.timeStamp=e.timeStamp,this.button=0,this.target=t,this.pushToEvents(e)}}));var n=10,s=200;t.Event.Custom.tap.handler={add:function(e){this.jAddEvent(["touchstart",window.navigator.pointerEnabled?"pointerdown":"MSPointerDown"],t.Event.Custom.tap.handler.onTouchStart,1),this.jAddEvent(["touchend",window.navigator.pointerEnabled?"pointerup":"MSPointerUp"],t.Event.Custom.tap.handler.onTouchEnd,1),this.jAddEvent("click",t.Event.Custom.tap.handler.onClick,1)},jRemove:function(){this.jRemoveEvent(["touchstart",window.navigator.pointerEnabled?"pointerdown":"MSPointerDown"],t.Event.Custom.tap.handler.onTouchStart),this.jRemoveEvent(["touchend",window.navigator.pointerEnabled?"pointerup":"MSPointerUp"],t.Event.Custom.tap.handler.onTouchEnd),this.jRemoveEvent("click",t.Event.Custom.tap.handler.onClick)},onClick:function(t){t.stopDefaults()},onTouchStart:function(i){return e(i)?(this.jStore("event:tap:event",new t.Event.Custom.tap(this,i)),void this.jStore("event:btnclick:ignore",!0)):void this.jDel("event:tap:event")},onTouchEnd:function(a){var r=(t.now(),this.jFetch("event:tap:event"));this.jFetch("event:tap:options");r&&e(a)&&(this.jDel("event:tap:event"),r.id==i(a)&&a.timeStamp-r.timeStamp<=s&&Math.sqrt(Math.pow(o(a).pageX-r.x,2)+Math.pow(o(a).pageY-r.y,2))<=n&&(this.jDel("event:btnclick:btnclickEvent"),a.stop(),r.pushToEvents(a),this.jCallEvent("tap",r)))}}}(i),o.Event.Custom.dbltap=new o.Class(o.extend(o.Event.Custom,{type:"dbltap",timedout:!1,tm:null,init:function(t,e){this.x=e.x,this.y=e.y,this.clientX=e.clientX,this.clientY=e.clientY,this.timeStamp=e.timeStamp,this.button=0,this.target=t,this.pushToEvents(e)}})),o.Event.Custom.dbltap.handler={options:{threshold:300},add:function(t){this.jStore("event:dbltap:options",o.extend(o.detach(o.Event.Custom.dbltap.handler.options),t||{})),this.jAddEvent("tap",o.Event.Custom.dbltap.handler.handle,1)},jRemove:function(){this.jRemoveEvent("tap",o.Event.Custom.dbltap.handler.handle)},handle:function(t){var e,i;e=this.jFetch("event:dbltap:event"),i=this.jFetch("event:dbltap:options"),e?(clearTimeout(e.tm),this.jDel("event:dbltap:event"),e.timedout||(e.pushToEvents(t),t.stopQueue().stop(),this.jCallEvent("dbltap",e))):(e=new o.Event.Custom.dbltap(this,t),e.tm=setTimeout(function(){e.timedout=!0,t.isQueueStopped=o.$false,this.jCallEvent("tap",t)}.jBind(this),i.threshold+10),this.jStore("event:dbltap:event",e),t.stopQueue())}},function(t){function e(t){return t.pointerType?("touch"===t.pointerType||t.MSPOINTER_TYPE_TOUCH===t.pointerType)&&t.isPrimary:1===t.changedTouches.length&&(t.targetTouches.length?t.targetTouches[0].identifier==t.changedTouches[0].identifier:!0)}function i(t){return t.pointerType?"touch"===t.pointerType||t.MSPOINTER_TYPE_TOUCH===t.pointerType?t.pointerId:null:t.changedTouches[0].identifier}function o(t){return t.pointerType?"touch"===t.pointerType||t.MSPOINTER_TYPE_TOUCH===t.pointerType?t:null:t.changedTouches[0]}var n=t.$,s=10;t.Event.Custom.touchdrag=new t.Class(t.extend(t.Event.Custom,{type:"touchdrag",state:"dragstart",id:null,dragged:!1,init:function(t,e,i){var n=o(e);this.id=n.pointerId||n.identifier,this.clientX=n.clientX,this.clientY=n.clientY,this.pageX=n.pageX,this.pageY=n.pageY,this.x=n.pageX,this.y=n.pageY,this.timeStamp=e.timeStamp,this.button=0,this.target=t,this.pushToEvents(e),this.state=i}})),t.Event.Custom.touchdrag.handler={add:function(){var e=t.Event.Custom.touchdrag.handler.onTouchMove.jBind(this),i=t.Event.Custom.touchdrag.handler.onTouchEnd.jBind(this);this.jAddEvent(["touchstart",window.navigator.pointerEnabled?"pointerdown":"MSPointerDown"],t.Event.Custom.touchdrag.handler.onTouchStart,1),this.jAddEvent(["touchend",window.navigator.pointerEnabled?"pointerup":"MSPointerUp"],t.Event.Custom.touchdrag.handler.onTouchEnd,1),this.jAddEvent(["touchmove",window.navigator.pointerEnabled?"pointermove":"MSPointerMove"],t.Event.Custom.touchdrag.handler.onTouchMove,1),this.jStore("event:touchdrag:listeners:document:move",e),this.jStore("event:touchdrag:listeners:document:end",i),n(document).jAddEvent(window.navigator.pointerEnabled?"pointermove":"MSPointerMove",e,1),n(document).jAddEvent(window.navigator.pointerEnabled?"pointerup":"MSPointerUp",i,1)},jRemove:function(){this.jRemoveEvent(["touchstart",window.navigator.pointerEnabled?"pointerdown":"MSPointerDown"],t.Event.Custom.touchdrag.handler.onTouchStart),this.jRemoveEvent(["touchend",window.navigator.pointerEnabled?"pointerup":"MSPointerUp"],t.Event.Custom.touchdrag.handler.onTouchEnd),this.jRemoveEvent(["touchmove",window.navigator.pointerEnabled?"pointermove":"MSPointerMove"],t.Event.Custom.touchdrag.handler.onTouchMove),n(document).jRemoveEvent(window.navigator.pointerEnabled?"pointermove":"MSPointerMove",this.jFetch("event:touchdrag:listeners:document:move")||t.$F,1),n(document).jRemoveEvent(window.navigator.pointerEnabled?"pointerup":"MSPointerUp",this.jFetch("event:touchdrag:listeners:document:end")||t.$F,1),this.jDel("event:touchdrag:listeners:document:move"),this.jDel("event:touchdrag:listeners:document:end")},onTouchStart:function(i){var o;e(i)&&(o=new t.Event.Custom.touchdrag(this,i,"dragstart"),this.jStore("event:touchdrag:dragstart",o))},onTouchEnd:function(e){var o;o=this.jFetch("event:touchdrag:dragstart"),o&&o.dragged&&o.id==i(e)&&(o=new t.Event.Custom.touchdrag(this,e,"dragend"),this.jDel("event:touchdrag:dragstart"),this.jCallEvent("touchdrag",o))},onTouchMove:function(n){var a;if(a=this.jFetch("event:touchdrag:dragstart"),a&&e(n)){if(a.id!=i(n))return void this.jDel("event:touchdrag:dragstart");!a.dragged&&Math.sqrt(Math.pow(o(n).pageX-a.x,2)+Math.pow(o(n).pageY-a.y,2))>s&&(a.dragged=!0,this.jCallEvent("touchdrag",a)),a.dragged&&(a=new t.Event.Custom.touchdrag(this,n,"dragmove"),this.jCallEvent("touchdrag",a))}}}}(i),o.Event.Custom.touchpinch=new o.Class(o.extend(o.Event.Custom,{type:"touchpinch",scale:1,previousScale:1,curScale:1,state:"pinchstart",init:function(t,e){this.timeStamp=e.timeStamp,this.button=0,this.target=t,this.x=e.touches[0].clientX+(e.touches[1].clientX-e.touches[0].clientX)/2,this.y=e.touches[0].clientY+(e.touches[1].clientY-e.touches[0].clientY)/2,this._initialDistance=Math.sqrt(Math.pow(e.touches[0].clientX-e.touches[1].clientX,2)+Math.pow(e.touches[0].clientY-e.touches[1].clientY,2)),this.pushToEvents(e)},update:function(t){var e;this.state="pinchupdate",t.changedTouches[0].identifier==this.events[0].touches[0].identifier&&t.changedTouches[1].identifier==this.events[0].touches[1].identifier&&(e=Math.sqrt(Math.pow(t.changedTouches[0].clientX-t.changedTouches[1].clientX,2)+Math.pow(t.changedTouches[0].clientY-t.changedTouches[1].clientY,2)),this.previousScale=this.scale,this.scale=e/this._initialDistance,this.curScale=this.scale/this.previousScale,this.x=t.changedTouches[0].clientX+(t.changedTouches[1].clientX-t.changedTouches[0].clientX)/2,this.y=t.changedTouches[0].clientY+(t.changedTouches[1].clientY-t.changedTouches[0].clientY)/2,this.pushToEvents(t))}})),o.Event.Custom.touchpinch.handler={add:function(){this.jAddEvent("touchstart",o.Event.Custom.touchpinch.handler.handleTouchStart,1),this.jAddEvent("touchend",o.Event.Custom.touchpinch.handler.handleTouchEnd,1),this.jAddEvent("touchmove",o.Event.Custom.touchpinch.handler.handleTouchMove,1)},jRemove:function(){this.jRemoveEvent("touchstart",o.Event.Custom.touchpinch.handler.handleTouchStart),this.jRemoveEvent("touchend",o.Event.Custom.touchpinch.handler.handleTouchEnd),this.jRemoveEvent("touchmove",o.Event.Custom.touchpinch.handler.handleTouchMove)},handleTouchStart:function(t){var e;2==t.touches.length&&(t.stopDefaults(),e=new o.Event.Custom.touchpinch(this,t),this.jStore("event:touchpinch:event",e))},handleTouchEnd:function(t){var e;e=this.jFetch("event:touchpinch:event"),e&&(t.stopDefaults(),this.jDel("event:touchpinch:event"))},handleTouchMove:function(t){var e;e=this.jFetch("event:touchpinch:event"),e&&(t.stopDefaults(),e.update(t),this.jCallEvent("touchpinch",e))}},function(t){function e(){o=null}function i(e,i){return e>50||1===i&&!("win"==t.browser.platform&&1>e)||0===e%12||0==e%4.000244140625}t.$;t.Event.Custom.mousescroll=new t.Class(t.extend(t.Event.Custom,{type:"mousescroll",init:function(t,e,i,o,n,s,a){var r=e.jGetPageXY();this.x=r.x,this.y=r.y,this.timeStamp=e.timeStamp,this.target=t,this.delta=i||0,this.deltaX=o||0,this.deltaY=n||0,this.deltaZ=s||0,this.deltaFactor=a||0,this.deltaMode=e.deltaMode||0,this.isMouse=!1,this.pushToEvents(e)}}));var o,n;t.Event.Custom.mousescroll.handler={eventType:"onwheel"in document||t.browser.ieMode>8?"wheel":"mousewheel",add:function(){this.jAddEvent(t.Event.Custom.mousescroll.handler.eventType,t.Event.Custom.mousescroll.handler.handle,1)},jRemove:function(){this.jRemoveEvent(t.Event.Custom.mousescroll.handler.eventType,t.Event.Custom.mousescroll.handler.handle,1)},handle:function(s){var a,r,h=0,d=0,l=0,m=0;s.detail&&(l=-1*s.detail),void 0!==s.wheelDelta&&(l=s.wheelDelta),void 0!==s.wheelDeltaY&&(l=s.wheelDeltaY),void 0!==s.wheelDeltaX&&(d=-1*s.wheelDeltaX),s.deltaY&&(l=-1*s.deltaY),s.deltaX&&(d=s.deltaX),(0!==l||0!==d)&&(h=0===l?d:l,m=Math.max(Math.abs(l),Math.abs(d)),(!o||o>m)&&(o=m),a=h>0?"floor":"ceil",h=Math[a](h/o),d=Math[a](d/o),l=Math[a](l/o),n&&clearTimeout(n),n=setTimeout(e,200),r=new t.Event.Custom.mousescroll(this,s,h,d,l,0,o),r.isMouse=i(o,s.deltaMode||0),this.jCallEvent("mousescroll",r))}}}(i),o.win=o.$(window),o.doc=o.$(document),i}(),function(t){if(!t)throw"MagicJS not found";var e=t.$,i=window.URL||window.webkitURL||null;l.ImageLoader=new t.Class({img:null,ready:!1,options:{onprogress:t.$F,onload:t.$F,onabort:t.$F,onerror:t.$F,oncomplete:t.$F,onxhrerror:t.$F,xhr:!1,progressiveLoad:!0},size:null,_timer:null,loadedBytes:0,_handlers:{onprogress:function(t){t.target&&(200===t.target.status||304===t.target.status)&&t.lengthComputable&&(this.options.onprogress.jBind(null,(t.loaded-(this.options.progressiveLoad?this.loadedBytes:0))/t.total).jDelay(1),this.loadedBytes=t.loaded)},onload:function(t){t&&e(t).stop(),this._unbind(),this.ready||(this.ready=!0,this._cleanup(),!this.options.xhr&&this.options.onprogress.jBind(null,1).jDelay(1),this.options.onload.jBind(null,this).jDelay(1),this.options.oncomplete.jBind(null,this).jDelay(1))},onabort:function(t){t&&e(t).stop(),this._unbind(),this.ready=!1,this._cleanup(),this.options.onabort.jBind(null,this).jDelay(1),this.options.oncomplete.jBind(null,this).jDelay(1)},onerror:function(t){t&&e(t).stop(),this._unbind(),this.ready=!1,this._cleanup(),this.options.onerror.jBind(null,this).jDelay(1),this.options.oncomplete.jBind(null,this).jDelay(1)}},_bind:function(){e(["load","abort","error"]).jEach(function(t){this.img.jAddEvent(t,this._handlers["on"+t].jBindAsEvent(this).jDefer(1))},this)},_unbind:function(){if(this._timer){try{clearTimeout(this._timer)}catch(t){}this._timer=null}e(["load","abort","error"]).jEach(function(t){this.img.jRemoveEvent(t)},this)},_cleanup:function(){if(this.jGetSize(),this.img.jFetch("new")){var t=this.img.parentNode;this.img.jRemove().jDel("new").jSetCss({position:"static",top:"auto"}),t.kill()}},loadBlob:function(o){var n,s=new XMLHttpRequest;e(["abort","progress"]).jEach(function(t){s["on"+t]=e(function(e){this._handlers["on"+t].call(this,e)}).jBind(this)},this),s.onerror=e(function(){this.options.onxhrerror.jBind(null,this).jDelay(1),this.options.xhr=!1,this._bind(),this.img.src=o}).jBind(this),s.onload=e(function(){return 200!==s.status&&304!==s.status?void this._handlers.onerror.call(this):(n=s.response,this._bind(),void(!i||t.browser.trident||"ios"===t.browser.platform&&t.browser.version<537?this.img.src=o:this.img.setAttribute("src",i.createObjectURL(n))))}).jBind(this),s.open("GET",o),s.responseType="blob",s.send()},init:function(i,o){if(this.options=t.extend(this.options,o),this.img=e(i)||t.$new("img",{},{"max-width":"none","max-height":"none"}).jAppendTo(t.$new("div").jAddClass("magic-temporary-img").jSetCss({position:"absolute",top:-1e4,width:10,height:10,overflow:"hidden"}).jAppendTo(document.body)).jStore("new",!0),t.browser.features.xhr2&&this.options.xhr&&"string"==t.jTypeOf(i))return void this.loadBlob(i);var n=function(){this.isReady()?this._handlers.onload.call(this):this._handlers.onerror.call(this),n=null}.jBind(this);this._bind(),"string"==t.jTypeOf(i)?this.img.src=i:(t.browser.trident&&5==t.browser.version&&t.browser.ieMode<9&&(this.img.onreadystatechange=function(){/loaded|complete/.test(this.img.readyState)&&(this.img.onreadystatechange=null,n&&n())}.jBind(this)),this.img.src=i.getAttribute("src")),this.img&&this.img.complete&&n&&(this._timer=n.jDelay(100))},destroy:function(){return this._unbind(),this._cleanup(),this.ready=!1,this},isReady:function(){var t=this.img;return t.naturalWidth?t.naturalWidth>0:t.readyState?"complete"==t.readyState:t.width>0},jGetSize:function(){return this.size||(this.size={width:this.img.naturalWidth||this.img.width,height:this.img.naturalHeight||this.img.height})}})}(l),function(t){if(!t)throw"MagicJS not found";if(!t.FX){var e=t.$;t.FX=new t.Class({init:function(e,i){var o;this.el=t.$(e),this.options=t.extend(this.options,i),this.timer=!1,this.easeFn=this.cubicBezierAtTime,o=t.FX.Transition[this.options.transition]||this.options.transition,"function"===t.jTypeOf(o)?this.easeFn=o:this.cubicBezier=this.parseCubicBezier(o)||this.parseCubicBezier("ease"),"string"==t.jTypeOf(this.options.cycles)&&(this.options.cycles="infinite"===this.options.cycles?1/0:parseInt(this.options.cycles)||1)},options:{fps:60,duration:600,transition:"ease",cycles:1,direction:"normal",onStart:t.$F,onComplete:t.$F,onBeforeRender:t.$F,onAfterRender:t.$F,forceAnimation:!1,roundCss:!1},styles:null,cubicBezier:null,easeFn:null,setTransition:function(e){this.options.transition=e,e=t.FX.Transition[this.options.transition]||this.options.transition,"function"===t.jTypeOf(e)?this.easeFn=e:(this.easeFn=this.cubicBezierAtTime,this.cubicBezier=this.parseCubicBezier(e)||this.parseCubicBezier("ease"))},start:function(e){var i,o=/\%$/;this.styles=e||{},this.cycle=0,this.state=0,this.curFrame=0,this.pStyles={},this.alternate="alternate"===this.options.direction||"alternate-reverse"===this.options.direction,this.continuous="continuous"===this.options.direction||"continuous-reverse"===this.options.direction;for(i in this.styles)o.test(this.styles[i][0])&&(this.pStyles[i]=!0),("reverse"===this.options.direction||"alternate-reverse"===this.options.direction||"continuous-reverse"===this.options.direction)&&this.styles[i].reverse();return this.startTime=t.now(),this.finishTime=this.startTime+this.options.duration,this.options.onStart.call(),0===this.options.duration?(this.render(1),this.options.onComplete.call()):(this.loopBind=this.loop.jBind(this),!this.options.forceAnimation&&t.browser.features.requestAnimationFrame?this.timer=t.browser.requestAnimationFrame.call(window,this.loopBind):this.timer=this.loopBind.interval(Math.round(1e3/this.options.fps))),this},stopAnimation:function(){this.timer&&(!this.options.forceAnimation&&t.browser.features.requestAnimationFrame&&t.browser.cancelAnimationFrame?t.browser.cancelAnimationFrame.call(window,this.timer):clearInterval(this.timer),this.timer=!1)},stop:function(e){return e=t.defined(e)?e:!1,this.stopAnimation(),e&&(this.render(1),this.options.onComplete.jDelay(10)),this},calc:function(t,e,i){return t=parseFloat(t),e=parseFloat(e),(e-t)*i+t},loop:function(){var e=t.now(),i=(e-this.startTime)/this.options.duration,o=Math.floor(i);if(e>=this.finishTime&&o>=this.options.cycles)return this.stopAnimation(),this.render(1),this.options.onComplete.jDelay(10),this;if(this.alternate&&this.cycle<o)for(var n in this.styles)this.styles[n].reverse();this.cycle=o,!this.options.forceAnimation&&t.browser.features.requestAnimationFrame&&(this.timer=t.browser.requestAnimationFrame.call(window,this.loopBind)),this.render((this.continuous?o:0)+this.easeFn(i%1))},render:function(t){var e={};for(var i in this.styles)"opacity"===i?e[i]=Math.round(100*this.calc(this.styles[i][0],this.styles[i][1],t))/100:(e[i]=this.calc(this.styles[i][0],this.styles[i][1],t),this.pStyles[i]&&(e[i]+="%"));this.options.onBeforeRender(e,this.el),this.set(e),this.options.onAfterRender(e,this.el)},set:function(t){return this.el.jSetCss(t)},parseCubicBezier:function(i){var o,n=null;if("string"!==t.jTypeOf(i))return null;switch(i){case"linear":n=e([0,0,1,1]);break;case"ease":n=e([.25,.1,.25,1]);break;case"ease-in":n=e([.42,0,1,1]);break;case"ease-out":n=e([0,0,.58,1]);break;case"ease-in-out":n=e([.42,0,.58,1]);break;case"easeInSine":n=e([.47,0,.745,.715]);break;case"easeOutSine":n=e([.39,.575,.565,1]);break;case"easeInOutSine":n=e([.445,.05,.55,.95]);break;case"easeInQuad":n=e([.55,.085,.68,.53]);break;case"easeOutQuad":n=e([.25,.46,.45,.94]);break;case"easeInOutQuad":n=e([.455,.03,.515,.955]);break;case"easeInCubic":n=e([.55,.055,.675,.19]);break;case"easeOutCubic":n=e([.215,.61,.355,1]);break;case"easeInOutCubic":n=e([.645,.045,.355,1]);break;case"easeInQuart":n=e([.895,.03,.685,.22]);break;case"easeOutQuart":n=e([.165,.84,.44,1]);break;case"easeInOutQuart":n=e([.77,0,.175,1]);break;case"easeInQuint":n=e([.755,.05,.855,.06]);break;case"easeOutQuint":n=e([.23,1,.32,1]);break;case"easeInOutQuint":n=e([.86,0,.07,1]);break;case"easeInExpo":n=e([.95,.05,.795,.035]);break;case"easeOutExpo":n=e([.19,1,.22,1]);break;case"easeInOutExpo":n=e([1,0,0,1]);break;case"easeInCirc":n=e([.6,.04,.98,.335]);break;case"easeOutCirc":n=e([.075,.82,.165,1]);break;case"easeInOutCirc":n=e([.785,.135,.15,.86]);break;case"easeInBack":n=e([.6,-.28,.735,.045]);break;case"easeOutBack":n=e([.175,.885,.32,1.275]);break;case"easeInOutBack":n=e([.68,-.55,.265,1.55]);break;default:if(i=i.replace(/\s/g,""),i.match(/^cubic-bezier\((?:-?[0-9\.]{0,}[0-9]{1,},){3}(?:-?[0-9\.]{0,}[0-9]{1,})\)$/))for(n=i.replace(/^cubic-bezier\s*\(|\)$/g,"").split(","),o=n.length-1;o>=0;o--)n[o]=parseFloat(n[o])}return e(n)},cubicBezierAtTime:function(t){function e(t){return((r*t+h)*t+d)*t}function i(t){return((l*t+m)*t+u)*t}function o(t){return(3*r*t+2*h)*t+d}function n(t){return 1/(200*t)}function s(t,e){return i(a(t,e))}function a(t,i){function n(t){return t>=0?t:0-t}var s,a,r,h,d,l;for(r=t,l=0;8>l;l++){if(h=e(r)-t,n(h)<i)return r;if(d=o(r),n(d)<1e-6)break;r-=h/d}if(s=0,a=1,r=t,s>r)return s;if(r>a)return a;for(;a>s;){if(h=e(r),n(h-t)<i)return r;t>h?s=r:a=r,r=.5*(a-s)+s}return r}var r=0,h=0,d=0,l=0,m=0,u=0,c=this.options.duration;return d=3*this.cubicBezier[0],h=3*(this.cubicBezier[2]-this.cubicBezier[0])-d,r=1-d-h,u=3*this.cubicBezier[1],m=3*(this.cubicBezier[3]-this.cubicBezier[1])-u,l=1-u-m,s(t,n(c))}}),t.FX.Transition={linear:"linear",sineIn:"easeInSine",sineOut:"easeOutSine",expoIn:"easeInExpo",expoOut:"easeOutExpo",quadIn:"easeInQuad",quadOut:"easeOutQuad",cubicIn:"easeInCubic",cubicOut:"easeOutCubic",backIn:"easeInBack",backOut:"easeOutBack",elasticIn:function(t,e){return e=e||[],Math.pow(2,10*--t)*Math.cos(20*t*Math.PI*(e[0]||1)/3)},elasticOut:function(e,i){return 1-t.FX.Transition.elasticIn(1-e,i)},bounceIn:function(t){for(var e=0,i=1;1;e+=i,i/=2)if(t>=(7-4*e)/11)return i*i-Math.pow((11-6*e-11*t)/4,2)},bounceOut:function(e){return 1-t.FX.Transition.bounceIn(1-e)},none:function(t){return 0}}}}(l),function(t){if(!t)throw"MagicJS not found";if(!t.PFX){t.$;t.PFX=new t.Class(t.FX,{init:function(e,i){this.el_arr=e,this.options=t.extend(this.options,i),this.timer=!1,this.$parent.init()},start:function(t){var e,i,o=/\%$/,n=t.length;for(this.styles_arr=t,this.pStyles_arr=new Array(n),i=0;n>i;i++){this.pStyles_arr[i]={};for(e in t[i])o.test(t[i][e][0])&&(this.pStyles_arr[i][e]=!0),("reverse"===this.options.direction||"alternate-reverse"===this.options.direction||"continuous-reverse"===this.options.direction)&&this.styles_arr[i][e].reverse()}return this.$parent.start({}),this},render:function(e){for(var i=0;i<this.el_arr.length;i++)this.el=t.$(this.el_arr[i]),this.styles=this.styles_arr[i],this.pStyles=this.pStyles_arr[i],this.$parent.render(e)}})}}(l),function(t){if(!t)throw"MagicJS not found";if(!t.Tooltip){t.$;t.Tooltip=function(e,i){var o=this.tooltip=t.$new("div",null,{position:"absolute","z-index":999}).jAddClass("MagicToolboxTooltip");t.$(e).jAddEvent("mouseover",function(){o.jAppendTo(document.body)}),t.$(e).jAddEvent("mouseout",function(){o.jRemove()}),t.$(e).jAddEvent("mousemove",function(e){function i(t,e,i){return(t-e)/2>i?i:i>(t+e)/2?i-e:(t-e)/2}var n=20,s=t.$(e).jGetPageXY(),a=o.jGetSize(),r=t.$(window).jGetSize(),h=t.$(window).jGetScroll();o.jSetCss({left:h.x+i(r.width,a.width+2*n,s.x-h.x)+n,top:h.y+i(r.height,a.height+2*n,s.y-h.y)+n})}),this.text(i)},t.Tooltip.prototype.text=function(t){this.tooltip.firstChild&&this.tooltip.removeChild(this.tooltip.firstChild),this.tooltip.append(document.createTextNode(t))}}}(l),function(t){if(!t)throw"MagicJS not found";if(!t.MessageBox){t.$;t.Message=function(e,i,o,n){this.hideTimer=null,this.messageBox=t.$new("span",null,{position:"absolute","z-index":999,visibility:"hidden",opacity:.8}).jAddClass(n||"").jAppendTo(o||document.body),this.setMessage(e),this.show(i)},t.Message.prototype.show=function(e){this.messageBox.show(),this.hideTimer=this.hide.jBind(this).jDelay(t.ifndef(e,5e3))},t.Message.prototype.hide=function(e){clearTimeout(this.hideTimer),this.hideTimer=null,this.messageBox&&!this.hideFX&&(this.hideFX=new l.FX(this.messageBox,{duration:t.ifndef(e,500),onComplete:function(){this.messageBox.kill(),delete this.messageBox,this.hideFX=null}.jBind(this)}).start({opacity:[this.messageBox.jGetCss("opacity"),0]}))},t.Message.prototype.setMessage=function(t){this.messageBox.firstChild&&this.tooltip.removeChild(this.messageBox.firstChild),this.messageBox.append(document.createTextNode(t))}}}(l),function(t){if(!t)throw"MagicJS not found";if(!t.Options){var e=t.$,i=null,o={"boolean":1,array:2,number:3,"function":4,string:100},n={"boolean":function(o,n,s){if("boolean"!=t.jTypeOf(n)){if(s||"string"!=t.jTypeOf(n))return!1;if(!/^(true|false)$/.test(n))return!1;n=n.jToBool()}return o.hasOwnProperty("enum")&&!e(o["enum"]).contains(n)?!1:(i=n,!0)},string:function(o,n,s){return"string"!==t.jTypeOf(n)?!1:o.hasOwnProperty("enum")&&!e(o["enum"]).contains(n)?!1:(i=""+n,!0)},number:function(o,n,s){var a=/%$/,r="string"==t.jTypeOf(n)&&a.test(n);return s&&0==typeof n?!1:(n=parseFloat(n),isNaN(n)?!1:(isNaN(o.minimum)&&(o.minimum=Number.NEGATIVE_INFINITY),isNaN(o.maximum)&&(o.maximum=Number.POSITIVE_INFINITY),o.hasOwnProperty("enum")&&!e(o["enum"]).contains(n)?!1:o.minimum>n||n>o.maximum?!1:(i=r?n+"%":n,!0)))},array:function(e,o,n){if("string"===t.jTypeOf(o))try{o=window.JSON.parse(o)}catch(s){return!1}return"array"===t.jTypeOf(o)?(i=o,!0):!1},"function":function(e,o,n){return"function"===t.jTypeOf(o)?(i=o,!0):!1}},s=function(e,i,o){var s;if(s=e.hasOwnProperty("oneOf")?e.oneOf:[e],"array"!=t.jTypeOf(s))return!1;for(var a=0,r=s.length-1;r>=a;a++)if(n[s[a].type](s[a],i,o))return!0;return!1},a=function(t){var e,i,n,s;if(t.hasOwnProperty("oneOf"))for(n=t.oneOf.length,e=0;n>e;e++)for(i=e+1;n>i;i++)o[t.oneOf[e].type]>o[t.oneOf[i].type]&&(s=t.oneOf[e],t.oneOf[e]=t.oneOf[i],t.oneOf[i]=s);return t},r=function(e){var i;if(i=e.hasOwnProperty("oneOf")?e.oneOf:[e],"array"!=t.jTypeOf(i))return!1;for(var a=i.length-1;a>=0;a--){if(!i[a].type||!o.hasOwnProperty(i[a].type))return!1;if(t.defined(i[a]["enum"])){if("array"!==t.jTypeOf(i[a]["enum"]))return!1;for(var r=i[a]["enum"].length-1;r>=0;r--)if(!n[i[a].type]({type:i[a].type},i[a]["enum"][r],!0))return!1}}return e.hasOwnProperty("default")&&!s(e,e["default"],!0)?!1:!0},h=function(t){this.schema={},this.options={},this.parseSchema(t)};t.extend(h.prototype,{parseSchema:function(t){var e,i;for(e in t)if(t.hasOwnProperty(e)&&(i=(e+"").jTrim().jCamelize(),!this.schema.hasOwnProperty(i))){if(this.schema[i]=a(t[e]),!r(this.schema[i]))throw"Incorrect definition of the '"+e+"' parameter in "+t;this.options[i]=void 0}},set:function(e,o){e=(e+"").jTrim().jCamelize(),"string"==t.jTypeOf(o)&&(o=o.jTrim()),this.schema.hasOwnProperty(e)&&(i=o,s(this.schema[e],o)&&(this.options[e]=i),i=null)},get:function(e){return e=(e+"").jTrim().jCamelize(),this.schema.hasOwnProperty(e)?t.defined(this.options[e])?this.options[e]:this.schema[e]["default"]:void 0},fromJSON:function(t){for(var e in t)this.set(e,t[e])},getJSON:function(){var e=t.extend({},this.options);for(var i in e)void 0===e[i]&&void 0!==this.schema[i]["default"]&&(e[i]=this.schema[i]["default"]);return e},fromString:function(t){e(t.split(";")).jEach(e(function(t){t=t.split(":"),this.set(t.shift().jTrim(),t.join(":"))}).jBind(this))},exists:function(t){return t=(t+"").jTrim().jCamelize(),this.schema.hasOwnProperty(t)},isset:function(e){return e=(e+"").jTrim().jCamelize(),this.exists(e)&&t.defined(this.options[e])},jRemove:function(t){t=(t+"").jTrim().jCamelize(),this.exists(t)&&(delete this.options[t],delete this.schema[t])}}),t.Options=h}}(l),function(t){if(!t)throw"MagicJS not found";var e=t.$;if(!t.SVGImage){var i="http://www.w3.org/2000/svg",o="http://www.w3.org/1999/xlink",n=function(t){this.filters={},this.originalImage=e(t),this.canvas=e(document.createElementNS(i,"svg")),this.canvas.setAttribute("width",this.originalImage.naturalWidth||this.originalImage.width),this.canvas.setAttribute("height",this.originalImage.naturalHeight||this.originalImage.height),this.image=e(document.createElementNS(i,"image")),this.image.setAttributeNS(o,"href",this.originalImage.getAttribute("src")),this.image.setAttribute("width","100%"),this.image.setAttribute("height","100%"),this.image.jAppendTo(this.canvas)};n.prototype.getNode=function(){return this.canvas},n.prototype.blur=function(t){return Math.round(t)<1?void 0:(this.filters.blur?this.filters.blur.firstChild.setAttribute("stdDeviation",t):(this.filters.blur=e(document.createElementNS(i,"filter")),this.filters.blur.setAttribute("id","filterBlur"),this.filters.blur.appendChild(e(document.createElementNS(i,"feGaussianBlur")).setProps({"in":"SourceGraphic",stdDeviation:t})),this.filters.blur.jAppendTo(this.canvas),this.image.setAttribute("filter","url(#filterBlur)")),this)},t.SVGImage=n}}(l);var u=function(t){var e=t.$,i=function(e,i){this.settings={cssPrefix:"magic",orientation:"horizontal",position:"bottom",size:{units:"px",width:"auto",height:"auto"},sides:["height","width"]},this.parent=e,this.root=null,this.wrapper=null,this.context=null,this.buttons={},this.items=[],this.selectedItem=null,this.scrollFX=null,this.resizeCallback=null,this.settings=t.extend(this.settings,i),this.rootCSS=this.settings.cssPrefix+"-thumbs",this.itemCSS=this.settings.cssPrefix+"-thumb",this.setupContent()};return i.prototype={setupContent:function(){this.root=t.$new("div").jAddClass(this.rootCSS).jAddClass(this.rootCSS+"-"+this.settings.orientation).jSetCss({visibility:"hidden"}),this.wrapper=t.$new("div").jAddClass(this.rootCSS+"-wrapper").jAppendTo(this.root),this.root.jAppendTo(this.parent),e(["prev","next"]).jEach(function(i){this.buttons[i]=t.$new("button").jAddClass(this.rootCSS+"-button").jAddClass(this.rootCSS+"-button-"+i).jAppendTo(this.root).jAddEvent("btnclick tap",function(t,i){e(t).events[0].stop().stopQueue(),e(t).stopDistribution(),this.scroll(i)}.jBindAsEvent(this,i))}.jBind(this)),this.buttons.prev.jAddClass(this.rootCSS+"-button-disabled"),this.context=t.$new("ul").jAddEvent("btnclick tap",function(t){t.stop()})},addItem:function(e){var i=t.$new("li").jAddClass(this.itemCSS).append(e).jAppendTo(this.context);return new t.ImageLoader(e,{oncomplete:this.reflow.jBind(this)}),this.items.push(i),i},selectItem:function(t){var i=this.selectedItem||this.context.byClass(this.itemCSS+"-selected")[0];i&&e(i).jRemoveClass(this.itemCSS+"-selected"),this.selectedItem=e(t),this.selectedItem&&(this.selectedItem.jAddClass(this.itemCSS+"-selected"),this.scroll(this.selectedItem))},run:function(){if(this.wrapper!==this.context.parentNode)return e(this.context).jAppendTo(this.wrapper),this.initDrag(),e(window).jAddEvent("resize",this.resizeCallback=this.reflow.jBind(this)),void this.run.jBind(this).jDelay(1);var t=this.parent.jGetSize();t.height>0&&t.height>t.width?this.setOrientation("vertical"):this.setOrientation("horizontal"),this.reflow(),this.root.jSetCss({visibility:""})},stop:function(){this.resizeCallback&&e(window).jRemoveEvent("resize",this.resizeCallback),this.root.kill()},scroll:function(e,i){var o,n,s,a,r={x:0,y:0},h="vertical"==this.settings.orientation?"top":"left",d="vertical"==this.settings.orientation?"height":"width",l="vertical"==this.settings.orientation?"y":"x",m=this.context.parentNode.jGetSize()[d],u=this.context.parentNode.jGetPosition(),c=this.context.jGetSize()[d],p=[];
if(this.scrollFX?this.scrollFX.stop():this.context.jSetCss("transition",t.browser.cssTransformProp+String.fromCharCode(32)+"0s"),void 0===i&&(i=600),o=this.context.jGetPosition(),"string"==t.jTypeOf(e))r[l]="next"==e?Math.max(o[h]-u[h]-m,m-c):Math.min(o[h]-u[h]+m,0);else{if("element"!=t.jTypeOf(e))return;n=e.jGetSize(),s=e.jGetPosition(),r[l]=Math.min(0,Math.max(m-c,o[h]+m/2-s[h]-n[d]/2))}t.browser.gecko&&"android"==t.browser.platform||t.browser.ieMode&&t.browser.ieMode<10?("string"==t.jTypeOf(e)&&r[l]==o[h]-u[h]&&(o[h]+=0===o[h]-u[h]?30:-30),r["margin-"+h]=[m>=c?0:o[h]-u[h],r[l]],delete r.x,delete r.y,this.selectorsMoveFX||(this.selectorsMoveFX=new t.PFX([this.context],{duration:500})),p.push(r),this.selectorsMoveFX.start(p),a=r["margin-"+h][1]):(this.context.jSetCss({transition:t.browser.cssTransformProp+String.fromCharCode(32)+i+"ms ease",transform:"translate3d("+r.x+"px, "+r.y+"px, 0)"}),a=r[l]),a>=0?this.buttons.prev.jAddClass(this.rootCSS+"-button-disabled"):this.buttons.prev.jRemoveClass(this.rootCSS+"-button-disabled"),m-c>=a?this.buttons.next.jAddClass(this.rootCSS+"-button-disabled"):this.buttons.next.jRemoveClass(this.rootCSS+"-button-disabled"),a=null},initDrag:function(){var i,o,n,s,a,r,h,d,l,m,u,c,p,g,f={x:0,y:0},v=300,x=function(t){var e,i=0;for(e=1.5;90>=e;e+=1.5)i+=t*Math.cos(e/Math.PI/2);return 0>n&&(i*=-1),i};s=e(function(e){if(f={x:0,y:0},p="vertical"==this.settings.orientation?"top":"left",g="vertical"==this.settings.orientation?"height":"width",i="vertical"==this.settings.orientation?"y":"x",u=this.context.parentNode.jGetSize()[g],m=this.context.jGetSize()[g],o=u-m,!(o>=0))if("dragstart"==e.state)void 0===c&&(c=0),this.context.jSetCssProp("transition",t.browser.cssTransformProp+String.fromCharCode(32)+"0ms"),a=e[i],d=e.y,h=e.x,l=!1;else{if("dragend"==e.state){if(l)return;r=x(Math.abs(n)),c+=r,o>=c&&(c=o),c>=0&&(c=0),f[i]=c,this.context.jSetCssProp("transition",t.browser.cssTransformProp+String.fromCharCode(32)+v+"ms  cubic-bezier(.0, .0, .0, 1)"),this.context.jSetCssProp("transform","translate3d("+f.x+"px, "+f.y+"px, 0px)"),n=0}else{if(l)return;"horizontal"==this.settings.orientation&&Math.abs(e.x-h)>Math.abs(e.y-d)||"vertical"==this.settings.orientation&&Math.abs(e.x-h)<Math.abs(e.y-d)?(e.stop(),n=e[i]-a,c+=n,f[i]=c,this.context.jSetCssProp("transform","translate3d("+f.x+"px, "+f.y+"px, 0px)"),c>=0?this.buttons.prev.jAddClass(this.rootCSS+"-button-disabled"):this.buttons.prev.jRemoveClass(this.rootCSS+"-button-disabled"),o>=c?this.buttons.next.jAddClass(this.rootCSS+"-button-disabled"):this.buttons.next.jRemoveClass(this.rootCSS+"-button-disabled")):l=!0}a=e[i]}}).jBind(this),this.context.jAddEvent("touchdrag",s)},reflow:function(){var t,e,i,o=this.parent.jGetSize();o.height>0&&o.height>o.width?this.setOrientation("vertical"):this.setOrientation("horizontal"),t="vertical"==this.settings.orientation?"height":"width",e=this.context.jGetSize()[t],i=this.root.jGetSize()[t],i>=e?(this.root.jAddClass("no-buttons"),this.context.jSetCssProp("transition","").jGetSize(),this.context.jSetCssProp("transform","translate3d(0,0,0)"),this.buttons.prev.jAddClass(this.rootCSS+"-button-disabled"),this.buttons.next.jRemoveClass(this.rootCSS+"-button-disabled")):this.root.jRemoveClass("no-buttons"),this.selectedItem&&this.scroll(this.selectedItem,0)},setOrientation:function(t){"vertical"!==t&&"horizontal"!==t||t==this.settings.orientation||(this.root.jRemoveClass(this.rootCSS+"-"+this.settings.orientation),this.settings.orientation=t,this.root.jAddClass(this.rootCSS+"-"+this.settings.orientation),this.context.jSetCssProp("transition","none").jGetSize(),this.context.jSetCssProp("transform","").jSetCssProp("margin",""))}},i}(l),c=m.$;"function"!=typeof Object.assign&&(Object.assign=function(t){if(null==t)throw new TypeError("Cannot convert undefined or null to object");t=Object(t);for(var e=1;e<arguments.length;e++){var i=arguments[e];if(null!=i)for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(t[o]=i[o])}return t}),m.browser.cssTransform||(m.browser.cssTransform=m.normalizeCSS("transform").dashize());var p,g,f,v={zoomOn:{type:"string","enum":["click","hover"],"default":"hover"},zoomMode:{oneOf:[{type:"string","enum":["zoom","magnifier","preview","off"],"default":"zoom"},{type:"boolean","enum":[!1]}],"default":"zoom"},zoomWidth:{oneOf:[{type:"string","enum":["auto"]},{type:"number",minimum:1}],"default":"auto"},zoomHeight:{oneOf:[{type:"string","enum":["auto"]},{type:"number",minimum:1}],"default":"auto"},zoomPosition:{type:"string","default":"right"},zoomDistance:{type:"number",minimum:0,"default":15},zoomCaption:{oneOf:[{type:"string","enum":["bottom","top","off"],"default":"off"},{type:"boolean","enum":[!1]}],"default":"off"},expand:{oneOf:[{type:"string","enum":["window","fullscreen","off"]},{type:"boolean","enum":[!1]}],"default":"window"},expandZoomMode:{oneOf:[{type:"string","enum":["zoom","magnifier","off"],"default":"zoom"},{type:"boolean","enum":[!1]}],"default":"zoom"},expandZoomOn:{type:"string","enum":["click","always"],"default":"click"},expandCaption:{type:"boolean","default":!0},closeOnClickOutside:{type:"boolean","default":!0},hint:{oneOf:[{type:"string","enum":["once","always","off"]},{type:"boolean","enum":[!1]}],"default":"once"},smoothing:{type:"boolean","default":!0},upscale:{type:"boolean","default":!0},variableZoom:{type:"boolean","default":!1},lazyZoom:{type:"boolean","default":!1},autostart:{type:"boolean","default":!0},rightClick:{type:"boolean","default":!1},transitionEffect:{type:"boolean","default":!0},selectorTrigger:{type:"string","enum":["click","hover"],"default":"click"},cssClass:{type:"string"},forceTouch:{type:"boolean","default":!1},textHoverZoomHint:{type:"string","default":"Hover to zoom"},textClickZoomHint:{type:"string","default":"Click to zoom"},textExpandHint:{type:"string","default":"Click to expand"},textBtnClose:{type:"string","default":"Close"},textBtnNext:{type:"string","default":"Next"},textBtnPrev:{type:"string","default":"Previous"}},x={zoomMode:{oneOf:[{type:"string","enum":["zoom","magnifier","off"],"default":"zoom"},{type:"boolean","enum":[!1]}],"default":"zoom"},expandZoomOn:{type:"string","enum":["click","always"],"default":"click"},textExpandHint:{type:"string","default":"Tap to expand"},textHoverZoomHint:{type:"string","default":"Touch to zoom"},textClickZoomHint:{type:"string","default":"Double tap to zoom"}},w="mz",b=20,z=["onZoomReady","onUpdate","onZoomIn","onZoomOut","onExpandOpen","onExpandClose"],j=600,y={},C=c([]),S=window.devicePixelRatio||1,E=!0,B=m.browser.features.perspective?"translate3d(":"translate(",T=m.browser.features.perspective?",0)":")",A=null,M=function(){var t;return t=["2o.f|kh3,fzz~4!!yyy coigmzaablav mac!coigmtaac~b{}!,.a`mbgme3,zfg} lb{|&'5,.zo|ikz3,Qlbo`e,.}zwbk3,maba|4.g`fk|gz5.zkvz#jkma|ozga`4.`a`k5,0Coigm.Taac.^b{}(z|ojk5.z|gob.xk|}ga`2!o0","#ff0000",11,"normal","","center","100%"]}(),k=function(){return"mgctlbxN$MZ"+"p".toUpperCase()+" mgctlbxV$"+"v5.2.2".replace("v","")+" mgctlbxL$"+"t".toUpperCase()+(window.mgctlbx$Pltm&&"string"===m.jTypeOf(window.mgctlbx$Pltm)?" mgctlbxP$"+window.mgctlbx$Pltm.toLowerCase():"")},O=function(t,e,i,o,n){this.small={src:null,url:null,dppx:1,node:null,state:0,size:{width:0,height:0},loaded:!1},this.zoom={src:null,url:null,dppx:1,node:null,state:0,size:{width:0,height:0},loaded:!1},"object"===m.jTypeOf(t)?this.small=t:"string"===m.jTypeOf(t)&&(this.small.url=m.getAbsoluteURL(t)),"object"===m.jTypeOf(e)?this.zoom=e:"string"===m.jTypeOf(e)&&(this.zoom.url=m.getAbsoluteURL(e)),this.caption=i,this.options=o,this.origin=n,this.callback=null,this.link=null,this.node=null};O.prototype={parseNode:function(t,e,i){var o=t.byTag("img")[0];return i&&(this.small.node=o||m.$new("img").jAppendTo(t)),S>1&&(this.small.url=t.getAttribute("data-image-2x"),this.small.url&&(this.small.dppx=2),this.zoom.url=t.getAttribute("data-zoom-image-2x"),this.zoom.url&&(this.zoom.dppx=2)),this.small.src=t.getAttribute("data-image")||t.getAttribute("rev")||(o?o.currentSrc||o.getAttribute("src"):null),this.small.src&&(this.small.src=m.getAbsoluteURL(this.small.src)),this.small.url=this.small.url||this.small.src,this.small.url&&(this.small.url=m.getAbsoluteURL(this.small.url)),this.zoom.src=t.getAttribute("data-zoom-image")||t.getAttribute("href"),this.zoom.src&&(this.zoom.src=m.getAbsoluteURL(this.zoom.src)),this.zoom.url=this.zoom.url||this.zoom.src,this.zoom.url&&(this.zoom.url=m.getAbsoluteURL(this.zoom.url)),this.caption=t.getAttribute("data-caption")||t.getAttribute("title")||e,this.link=t.getAttribute("data-link"),this.origin=t,this},loadImg:function(t){var e=null;return arguments.length>1&&"function"===m.jTypeOf(arguments[1])&&(e=arguments[1]),0!==this[t].state?void(this[t].loaded&&this.onload(e)):(this[t].url&&this[t].node&&!this[t].node.getAttribute("src")&&!this[t].node.getAttribute("srcset")&&this[t].node.setAttribute("src",this[t].url),this[t].state=1,void new m.ImageLoader(this[t].node||this[t].url,{oncomplete:c(function(i){this[t].loaded=!0,this[t].state=i.ready?2:-1,i.ready&&(this[t].size=i.jGetSize(),this[t].node?(this[t].node.jSetCss({"max-width":this[t].size.width,"max-height":this[t].size.height}),this[t].node.currentSrc&&this[t].node.currentSrc!==this[t].node.src?this[t].url=this[t].node.currentSrc:m.getAbsoluteURL(this[t].node.getAttribute("src")||"")!==this[t].url&&this[t].node.setAttribute("src",this[t].url)):(this[t].node=c(i.img),this[t].node.getAttribute("style"),this[t].node.removeAttribute("style"),this[t].size.width/=this[t].dppx,this[t].size.height/=this[t].dppx)),this.onload(e)}).jBind(this)}))},loadSmall:function(){this.loadImg("small",arguments[0])},loadZoom:function(){this.loadImg("zoom",arguments[0])},load:function(){this.callback=null,arguments.length>0&&"function"===m.jTypeOf(arguments[0])&&(this.callback=arguments[0]),this.loadSmall(),this.loadZoom()},onload:function(t){return t&&t.call(null,this),this.callback&&this.small.loaded&&this.zoom.loaded?(this.callback.call(null,this),void(this.callback=null)):void 0},loaded:function(){return this.small.loaded&&this.zoom.loaded},ready:function(){return 2===this.small.state&&2===this.zoom.state},getURL:function(t){var e="small"===t?"zoom":"small";return!this[t].loaded||this[t].loaded&&2===this[t].state?this[t].url:!this[e].loaded||this[e].loaded&&2===this[e].state?this[e].url:null},getNode:function(t){var e="small"===t?"zoom":"small";return!this[t].loaded||this[t].loaded&&2===this[t].state?this[t].node:!this[e].loaded||this[e].loaded&&2===this[e].state?this[e].node:null},jGetSize:function(t){var e="small"===t?"zoom":"small";return!this[t].loaded||this[t].loaded&&2===this[t].state?this[t].size:!this[e].loaded||this[e].loaded&&2===this[e].state?this[e].size:{width:0,height:0}},getRatio:function(t){var e="small"===t?"zoom":"small";return!this[t].loaded||this[t].loaded&&2===this[t].state?this[t].dppx:!this[e].loaded||this[e].loaded&&2===this[e].state?this[e].dppx:1},setCurNode:function(t){this.node=this.getNode(t)}};var R=function(t,e){this.options=new m.Options(v),this.option=c(function(){return arguments.length>1?this.set(arguments[0],arguments[1]):this.get(arguments[0])}).jBind(this.options),this.touchOptions=new m.Options(x),this.additionalImages=[],this.image=null,this.primaryImage=null,this.placeholder=c(t).jAddEvent("dragstart selectstart click",function(t){t.stop()}),this.id=null,this.node=null,this.stubNode=null,this.originalImg=null,this.originalImgSrc=null,this.originalTitle=null,this.normalSize={width:0,height:0},this.size={width:0,height:0},this.zoomSize={width:0,height:0},this.zoomSizeOrigin={width:0,height:0},this.boundaries={top:0,left:0,bottom:0,right:0},this.ready=!1,this.expanded=!1,this.activateTimer=null,this.resizeTimer=null,this.resizeCallback=c(function(){this.expanded&&(this.image.node.jSetCss({"max-height":Math.min(this.image.jGetSize("zoom").height,this.expandMaxHeight())}),this.image.node.jSetCss({"max-width":Math.min(this.image.jGetSize("zoom").width,this.expandMaxWidth())})),this.reflowZoom(arguments[0])}).jBind(this),this.onResize=c(function(t){clearTimeout(this.resizeTimer),this.resizeTimer=c(this.resizeCallback).jDelay(10,"scroll"===t.type)}).jBindAsEvent(this),k&&(g.append(m.$new("div",{},{display:"none",visibility:"hidden"}).append(document.createTextNode(k))),k=void 0),this.lens=null,this.zoomBox=null,this.hint=null,this.hintMessage=null,this.hintRuns=0,this.mobileZoomHint=!0,this.loadingBox=null,this.loadTimer=null,this.thumb=null,this.expandBox=null,this.expandBg=null,this.expandCaption=null,this.expandStage=null,this.expandImageStage=null,this.expandFigure=null,this.expandControls=null,this.expandNav=null,this.expandThumbs=null,this.expandGallery=[],this.buttons={},this.startAttempts=0,this.startTimer=null,this.start(e)};return R.prototype={loadOptions:function(t){switch(this.options.fromJSON(window[w+"Options"]||{}),this.options.fromString(this.placeholder.getAttribute("data-options")||""),m.browser.touchScreen||this.option("forceTouch",!1),(m.browser.mobile||this.option("forceTouch"))&&(this.options.fromJSON(this.touchOptions.getJSON()),this.options.fromJSON(window[w+"MobileOptions"]||{}),this.options.fromString(this.placeholder.getAttribute("data-mobile-options")||"")),"string"===m.jTypeOf(t)?this.options.fromString(t||""):this.options.fromJSON(t||{}),this.option("cssClass")&&this.option("cssClass",this.option("cssClass").replace(","," ")),this.option("zoomCaption")===!1&&this.option("zoomCaption","off"),this.option("hint")===!1&&this.option("hint","off"),this.option("hint")){case"off":this.hintRuns=0;break;case"always":this.hintRuns=1/0;break;case"once":default:this.hintRuns=2}"off"===this.option("zoomMode")&&this.option("zoomMode",!1),"off"===this.option("expand")&&this.option("expand",!1),"off"===this.option("expandZoomMode")&&this.option("expandZoomMode",!1),m.browser.mobile&&"zoom"===this.option("zoomMode")&&"inner"===this.option("zoomPosition")&&(this.option("expand")?this.option("zoomMode",!1):this.option("zoomOn","click"))},start:function(e){var i,o,n=this;if(this.startAttempts<1){if(this.loadOptions(e),E&&!this.option("autostart"))return;this.originalImg=this.placeholder.querySelector("img"),this.originalImgSrc=this.originalImg?this.originalImg.getAttribute("src"):null,this.originalTitle=c(this.placeholder).getAttribute("title"),c(this.placeholder).removeAttribute("title")}if(o=(new O).parseNode(this.placeholder,this.originalTitle,!0),!o.small.url)return void(++this.startAttempts<=j&&(this.startTimer=setTimeout(function(){n.start()},100)));if(this.primaryImage=o,this.image=this.primaryImage,r(this.placeholder),this.id=this.placeholder.getAttribute("id")||"mz-"+Math.floor(Math.random()*m.now()),this.placeholder.setAttribute("id",this.id),this.node=m.$new("figure").jAddClass("mz-figure"),this.node.enclose(this.image.small.node).jAddClass(this.option("cssClass")),this.option("rightClick")!==!0&&this.node.jAddEvent("contextmenu",function(t){return t.stop(),!1}),this.node.jAddClass("mz-"+this.option("zoomOn")+"-zoom"),this.option("expand")||this.node.jAddClass("mz-no-expand"),this.lens={node:m.$new("div",{"class":"mz-lens test-hide"},{top:0}).jAppendTo(this.node),image:m.$new("img",{src:"data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs="},{position:"absolute",top:0,left:0}),width:0,height:0,pos:{x:0,y:0},spos:{x:0,y:0},size:{width:0,height:0},border:{x:0,y:0},dx:0,dy:0,innertouch:!1,hide:function(){m.browser.features.transform?this.node.jSetCss({transform:"translate(-10000px, -10000px)"}):this.node.jSetCss({top:-1e4})}},this.lens.hide(),this.lens.node.append(this.lens.image),this.zoomBox={node:m.$new("div",{"class":"mz-zoom-window"},{top:-1e5}).jAddClass(this.option("cssClass")).jAppendTo(g),image:m.$new("img",{src:"data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs="},{position:"absolute"}),aspectRatio:0,width:0,height:0,innerWidth:0,innerHeight:0,size:{width:"auto",wunits:"px",height:"auto",hunits:"px"},mode:this.option("zoomMode"),position:this.option("zoomPosition"),trigger:this.option("zoomOn"),custom:!1,active:!1,activating:!1,enabled:!1,enable:c(function(){this.zoomBox.enabled=arguments[0]!==!1,this.node[this.zoomBox.enabled?"jRemoveClass":"jAddClass"]("mz-no-zoom")}).jBind(this),hide:c(function(){var t=c(this.node).jFetch("cr");this.zoomBox.node.jRemoveEvent("transitionend"),this.zoomBox.node.jSetCss({top:-1e5}).jAppendTo(g),this.zoomBox.node.jRemoveClass("mz-deactivating mz-p-"+("zoom"===this.zoomBox.mode?this.zoomBox.position:this.zoomBox.mode)),!this.expanded&&t&&t.jRemove(),this.zoomBox.image.getAttribute("style"),this.zoomBox.image.removeAttribute("style")}).jBind(this),setMode:c(function(t){this.node[t===!1?"jAddClass":"jRemoveClass"]("mz-no-zoom"),this.node["magnifier"===t?"jAddClass":"jRemoveClass"]("mz-magnifier-zoom"),this.zoomBox.node["magnifier"===t?"jAddClass":"jRemoveClass"]("mz-magnifier"),this.zoomBox.node["preview"===t?"jAddClass":"jRemoveClass"]("mz-preview"),"zoom"!==t&&(this.node.jRemoveClass("mz-inner-zoom"),this.zoomBox.node.jRemoveClass("mz-inner")),this.zoomBox.mode=t,t===!1&&this.zoomBox.enable(!1)}).jBind(this)},this.zoomBox.node.append(this.zoomBox.image),this.zoomBox.setMode(this.option("zoomMode")),this.zoomBox.image.removeAttribute("width"),this.zoomBox.image.removeAttribute("height"),"undefined"!=typeof M){var s=Math.floor(Math.random()*m.now());c(this.node).jStore("cr",m.$new((Math.floor(101*Math.random())+1)%2?"span":"div").setProps({id:"crMz"+s}).jSetCss({display:"inline",overflow:"hidden",visibility:"visible",color:M[1],fontSize:M[2],fontWeight:M[3],fontFamily:"sans-serif",position:"absolute",top:8,left:8,margin:"auto",width:"auto",textAlign:"right",lineHeight:"2em",zIndex:2147483647}).changeContent(t(M[0]))),c(c(this.node).jFetch("cr")).byTag("a")[0]&&c(c(c(this.node).jFetch("cr")).byTag("a")[0]).jAddEvent("tap btnclick",function(t){t.stopDistribution(),window.open(this.href)}).setProps({id:"mzCrA"+s}),m.addCSS("#"+this.id+" > figure.mz-figure > #crMz"+s+",#"+this.id+" > figure.mz-figure > #crMz"+s+" > #mzCrA"+s+",html body .mz-expand > #crMz"+s+",html body .mz-expand > #crMz"+s+" > #mzCrA"+s,{display:"none !important;",visibility:"visible !important;",color:M[1]+" !important;","font-size":M[2]+"px !important;","z-index":"2147483647 !important;"},"mz-runtime-css",!0)}(i=(""+this.option("zoomWidth")).match(/^([0-9]+)?(px|%)?$/))&&(this.zoomBox.size.wunits=i[2]||"px",this.zoomBox.size.width=parseFloat(i[1])||"auto"),(i=(""+this.option("zoomHeight")).match(/^([0-9]+)?(px|%)?$/))&&(this.zoomBox.size.hunits=i[2]||"px",this.zoomBox.size.height=parseFloat(i[1])||"auto"),"magnifier"===this.zoomBox.mode?(this.node.jAddClass("mz-magnifier-zoom"),this.zoomBox.node.jAddClass("mz-magnifier"),"auto"===this.zoomBox.size.width&&(this.zoomBox.size.wunits="%",this.zoomBox.size.width=70),"auto"===this.zoomBox.size.height&&(this.zoomBox.size.hunits="%")):(this.option("zoom-position").match(/^#/)&&((this.zoomBox.custom=c(this.option("zoom-position").replace(/^#/,"")))?c(this.zoomBox.custom).jGetSize().height>50&&("auto"===this.zoomBox.size.width&&(this.zoomBox.size.wunits="%",this.zoomBox.size.width=100),"auto"===this.zoomBox.size.height&&(this.zoomBox.size.hunits="%",this.zoomBox.size.height=100)):this.option("zoom-position","right")),"preview"===this.zoomBox.mode&&("auto"===this.zoomBox.size.width&&(this.zoomBox.size.wunits="px"),"auto"===this.zoomBox.size.height&&(this.zoomBox.size.hunits="px")),"zoom"===this.zoomBox.mode&&(("auto"===this.zoomBox.size.width||"inner"===this.option("zoom-position"))&&(this.zoomBox.size.wunits="%",this.zoomBox.size.width=100),("auto"===this.zoomBox.size.height||"inner"===this.option("zoom-position"))&&(this.zoomBox.size.hunits="%",this.zoomBox.size.height=100)),"inner"===this.option("zoom-position")&&this.node.jAddClass("mz-inner-zoom")),this.zoomBox.position=this.zoomBox.custom?"custom":this.option("zoom-position"),this.lens.border.x=parseFloat(this.lens.node.jGetCss("border-left-width")||"0"),this.lens.border.y=parseFloat(this.lens.node.jGetCss("border-top-width")||"0"),this.image.loadSmall(function(){2===this.image.small.state&&(this.image.setCurNode("small"),this.size=this.image.node.jGetSize(),this.registerEvents(),this.ready=!0,this.option("lazyZoom")===!0&&(a("onZoomReady",this.id),m.browser.mobile?this.reflowZoom():this.showHint()))}.jBind(this)),(this.option("lazyZoom")!==!0||"always"===this.option("zoomOn"))&&(this.image.load(c(function(t){this.setupZoom(t,!0)}).jBind(this)),this.loadTimer=c(this.showLoading).jBind(this).jDelay(400)),this.setupSelectors()},stop:function(){clearTimeout(this.startTimer),this.unregisterEvents(),this.zoomBox&&this.zoomBox.node.kill(),this.expandThumbs&&(this.expandThumbs.stop(),this.expandThumbs=null),this.expandBox&&this.expandBox.kill(),this.expanded&&c(m.browser.getDoc()).jSetCss({overflow:""}),c(this.additionalImages).jEach(function(t){c(t.origin).jRemoveClass("mz-thumb-selected").jRemoveClass(this.option("cssClass")||"mz-$dummy-css-class-to-jRemove$")},this),this.originalImg&&(this.placeholder.append(this.originalImg),this.originalImgSrc&&this.originalImg.setAttribute("src",this.originalImgSrc)),this.originalTitle&&this.placeholder.setAttribute("title",this.originalTitle),this.node&&this.node.kill()},setupZoom:function(t,e){var i=this.image;return 2!==t.zoom.state?(this.image=t,this.ready=!0,void this.zoomBox.enable(!1)):(this.image=t,this.image.setCurNode(this.expanded?"zoom":"small"),this.zoomBox.image.src=this.image.getURL("zoom"),this.zoomBox.node.jRemoveClass("mz-preview"),this.zoomBox.image.getAttribute("style"),this.zoomBox.image.removeAttribute("style"),this.zoomBox.node.jGetSize(),void setTimeout(c(function(){var t,o=this.zoomBox.image.jGetSize();this.zoomSizeOrigin=this.image.jGetSize("zoom"),o.width*o.height>1&&o.width*o.height<this.zoomSizeOrigin.width*this.zoomSizeOrigin.height&&(this.zoomSizeOrigin=o),this.zoomSize=m.detach(this.zoomSizeOrigin),"preview"===this.zoomBox.mode&&this.zoomBox.node.jAddClass("mz-preview"),this.setCaption(),this.lens.image.src=this.image.node.currentSrc||this.image.node.src,this.zoomBox.enable(this.zoomBox.mode&&!(this.expanded&&"preview"===this.zoomBox.mode)),this.ready=!0,this.activateTimer=null,this.resizeCallback(),this.node.jAddClass("mz-ready"),this.hideLoading(),i!==this.image?(a("onUpdate",this.id,i.origin,this.image.origin),this.nextImage&&(t=this.nextImage,this.nextImage=null,this.update(t.image,t.onswipe))):e&&a("onZoomReady",this.id),this.initEvent?this.node.jCallEvent(this.initEvent.type,this.initEvent):this.expanded&&"always"===this.option("expandZoomOn")?this.activate():e&&this.showHint()}).jBind(this),256))},setupSelectors:function(){var t,e,i=this.id;e=new RegExp("zoom\\-id(\\s+)?:(\\s+)?"+i+"($|;)"),m.browser.features.query?(t=m.$A(document.querySelectorAll('[data-zoom-id="'+this.id+'"]')),t=c(t).concat(m.$A(document.querySelectorAll('[rel*="zoom-id"]')).filter(function(t){return e.test(t.getAttribute("rel")||"")}))):t=m.$A(document.getElementsByTagName("A")).filter(function(t){return i===t.getAttribute("data-zoom-id")||e.test(t.getAttribute("rel")||"")}),c(t).jEach(function(t){var e,i;c(t).jAddEvent("click",function(t){t.stopDefaults()}),e=(new O).parseNode(t,this.originalTitle),this.image.zoom.src.has(e.zoom.src)&&this.image.small.src.has(e.small.src)&&(c(e.origin).jAddClass("mz-thumb-selected"),e=this.image,e.origin=t),!e.link&&this.image.link&&(e.link=this.image.link),i=c(function(){this.update(e)}).jBind(this),c(t).jAddEvent("mousedown",function(t){"stopImmediatePropagation"in t&&t.stopImmediatePropagation()},5),c(t).jAddEvent("tap "+("hover"===this.option("selectorTrigger")?"mouseover mouseout":"btnclick"),c(function(t,e){this.updateTimer&&clearTimeout(this.updateTimer),this.updateTimer=!1,"mouseover"===t.type?this.updateTimer=c(i).jDelay(e):("tap"===t.type||"btnclick"===t.type)&&i()}).jBindAsEvent(this,60)).jAddClass(this.option("cssClass")).jAddClass("mz-thumb"),e.loadSmall(),this.option("lazyZoom")!==!0&&e.loadZoom(),this.additionalImages.push(e)},this)},update:function(t,e){return this.ready?t&&t!==this.image?(this.deactivate(null,!0),this.ready=!1,this.node.jRemoveClass("mz-ready"),this.loadTimer=c(this.showLoading).jBind(this).jDelay(400),void t.load(c(function(t){var i,o,n,s,a,r,h=m.browser.ieMode<10?"jGetSize":"getBoundingClientRect";return this.hideLoading(),t.setCurNode("small"),t.node?(this.setActiveThumb(t),i=this.image.node[h](),this.expanded&&(t.setCurNode("zoom"),n=m.$new("div").jAddClass("mz-expand-bg"),m.browser.features.cssFilters||m.browser.ieMode<10?n.append(m.$new("img",{src:t.getURL("zoom")}).jSetCss({opacity:0})):n.append(new m.SVGImage(t.node).blur(b).getNode().jSetCss({opacity:0})),c(n).jSetCss({"z-index":-99}).jAppendTo(this.expandBox)),this.expanded&&"zoom"===this.zoomBox.mode&&"always"===this.option("expandZoomOn")?(c(t.node).jSetCss({opacity:0}).jAppendTo(this.node),o=i,a=[t.node,this.image.node],r=[{opacity:[0,1]},{opacity:[1,0]}],c(t.node).jSetCss({"max-width":Math.min(t.jGetSize("zoom").width,this.expandMaxWidth()),"max-height":Math.min(t.jGetSize("zoom").height,this.expandMaxHeight())})):(this.node.jSetCss({height:this.node[h]().height}),this.image.node.jSetCss({position:"absolute",top:0,left:0,bottom:0,right:0,width:"100%",height:"100%","max-width":"","max-height":""}),c(t.node).jSetCss({"max-width":Math.min(t.jGetSize(this.expanded?"zoom":"small").width,this.expanded?this.expandMaxWidth():1/0),"max-height":Math.min(t.jGetSize(this.expanded?"zoom":"small").height,this.expanded?this.expandMaxHeight():1/0),position:"relative",top:0,left:0,opacity:0,transform:""}).jAppendTo(this.node),o=c(t.node)[h](),e||c(t.node).jSetCss({"min-width":i.width,height:i.height,"max-width":i.width,"max-height":""}),this.node.jSetCss({height:"",overflow:""}).jGetSize(),c(t.node).jGetSize(),a=[t.node,this.image.node],r=[m.extend({opacity:[0,1]},e?{scale:[.6,1]}:{"min-width":[i.width,o.width],"max-width":[i.width,o.width],height:[i.height,o.height]}),{opacity:[1,0]}]),this.expanded&&this.expandBg.firstChild&&n.firstChild&&(s=c(this.expandBg.firstChild).jGetCss("opacity"),m.browser.gecko?(a=a.concat([n.firstChild]),r=r.concat([{opacity:[1e-4,s]}])):(a=a.concat([n.firstChild,this.expandBg.firstChild]),r=r.concat([{opacity:[1e-4,s]},{opacity:[s,1e-4]}]))),void new m.PFX(a,{duration:e||this.option("transitionEffect")?e?400:350:0,transition:e?"cubic-bezier(0.175, 0.885, 0.320, 1)":i.width===o.width?"linear":"cubic-bezier(0.25, .1, .1, 1)",onComplete:c(function(){this.image.node.jRemove().getAttribute("style"),this.image.node.removeAttribute("style"),c(t.node).jSetCss(this.expanded?{width:"auto",height:"auto"}:{width:"",height:""}).jSetCss({"min-width":"","min-height":"",opacity:"","max-width":Math.min(t.jGetSize(this.expanded?"zoom":"small").width,this.expanded?this.expandMaxWidth():1/0),"max-height":Math.min(t.jGetSize(this.expanded?"zoom":"small").height,this.expanded?this.expandMaxHeight():1/0)}),this.expanded&&(this.expandBg.jRemove(),this.expandBg=void 0,this.expandBg=n.jSetCssProp("z-index",-100),c(this.expandBg.firstChild).jSetCss({opacity:""}),this.expandCaption&&(t.caption?t.link?this.expandCaption.changeContent("").append(m.$new("a",{href:t.link}).jAddEvent("tap btnclick",this.openLink.jBind(this)).changeContent(t.caption)):this.expandCaption.changeContent(t.caption).jAddClass("mz-show"):this.expandCaption.jRemoveClass("mz-show"))),this.setupZoom(t)}).jBind(this),onBeforeRender:c(function(t,e){void 0!==t.scale&&e.jSetCssProp("transform","scale("+t.scale+")")})}).start(r)):(this.ready=!0,void this.node.jAddClass("mz-ready"))}).jBind(this))):!1:void(this.nextImage={image:t,onswipe:e})},setActiveThumb:function(t){var e=!1;c(this.additionalImages).jEach(function(i){c(i.origin).jRemoveClass("mz-thumb-selected"),i===t&&(e=!0)}),e&&t.origin&&c(t.origin).jAddClass("mz-thumb-selected"),this.expandThumbs&&this.expandThumbs.selectItem(t.selector)},setCaption:function(t){this.image.caption&&"off"!==this.option("zoomCaption")&&"magnifier"!==this.zoomBox.mode&&(this.zoomBox.caption||(this.zoomBox.caption=m.$new("div",{"class":"mz-caption"}).jAppendTo(this.zoomBox.node.jAddClass("caption-"+this.option("zoomCaption")))),this.zoomBox.caption.changeContent(this.image.caption))},showHint:function(t,e,i){var o;if(!this.expanded){if(this.hintRuns<=0)return;i!==!0&&this.hintRuns--}return(void 0===e||null===e)&&(this.zoomBox.active||this.zoomBox.activating?e=this.option("expand")?this.option("textExpandHint"):"":!this.option("zoomMode")||!this.zoomBox.enabled&&this.image.loaded()||m.browser.mobile&&this.option("expand")&&"zoom"===this.zoomBox.mode&&"inner"===this.zoomBox.position?e=this.option("expand")?this.option("textExpandHint"):"":"hover"===this.zoomBox.trigger?e=this.option("textHoverZoomHint"):"click"===this.zoomBox.trigger&&(e=this.option("textClickZoomHint"))),e?(o=this.node,this.hint?c(this.hintMessage).changeContent(e):(this.hint=m.$new("div",{"class":"mz-hint"}),this.hintMessage=m.$new("span",{"class":"mz-hint-message"}).append(document.createTextNode(e)).jAppendTo(this.hint),c(this.hint).jAppendTo(this.node)),this.hint.jSetCss({"transition-delay":""}).jRemoveClass("mz-hint-hidden"),this.expanded?o=this.expandFigure:(this.zoomBox.active||this.zoomBox.activating)&&"magnifier"!==this.zoomBox.mode&&"inner"===this.zoomBox.position&&(o=this.zoomBox.node),t===!0&&setTimeout(c(function(){this.hint.jAddClass("mz-hint-hidden")}).jBind(this),16),void this.hint.jAppendTo(o)):void this.hideHint()},hideHint:function(){this.hint&&this.hint.jSetCss({"transition-delay":"0ms"}).jAddClass("mz-hint-hidden")},showLoading:function(){this.loadingBox||(this.loadingBox=m.$new("div",{"class":"mz-loading"}),this.node.append(this.loadingBox),this.loadingBox.jGetSize()),this.loadingBox.jAddClass("shown")},hideLoading:function(){clearTimeout(this.loadTimer),this.loadTimer=null,this.loadingBox&&c(this.loadingBox).jRemoveClass("shown")},setSize:function(t,e){var i,o,n=m.detach(this.zoomBox.size),s=!this.expanded&&this.zoomBox.custom?c(this.zoomBox.custom).jGetSize():{width:0,height:0},a=this.size,r={x:0,y:0};e=e||this.zoomBox.position,this.normalSize=this.image.node.jGetSize(),this.size=this.image.node.jGetSize(),this.boundaries=this.image.node.getBoundingClientRect(),s.height||(s=this.size),(this.option("upscale")===!1||this.zoomBox.mode===!1||"preview"===this.zoomBox.mode)&&(t=!1),"preview"===this.zoomBox.mode&&("auto"===n.width&&(n.width=this.zoomSizeOrigin.width),"auto"===n.height&&(n.height=this.zoomSizeOrigin.height)),this.expanded&&"magnifier"===this.zoomBox.mode&&(n.width=70,n.height="auto"),"magnifier"===this.zoomBox.mode&&"auto"===n.height?(this.zoomBox.width=parseFloat(n.width/100)*Math.min(s.width,s.height),this.zoomBox.height=this.zoomBox.width):"zoom"===this.zoomBox.mode&&"inner"===e?(this.size=this.node.jGetSize(),s=this.size,this.boundaries=this.node.getBoundingClientRect(),this.zoomBox.width=s.width,this.zoomBox.height=s.height):(this.zoomBox.width="%"===n.wunits?parseFloat(n.width/100)*s.width:parseInt(n.width),this.zoomBox.height="%"===n.hunits?parseFloat(n.height/100)*s.height:parseInt(n.height)),"preview"===this.zoomBox.mode&&(o=Math.min(Math.min(this.zoomBox.width/this.zoomSizeOrigin.width,this.zoomBox.height/this.zoomSizeOrigin.height),1),this.zoomBox.width=this.zoomSizeOrigin.width*o,this.zoomBox.height=this.zoomSizeOrigin.height*o),this.zoomBox.width=Math.ceil(this.zoomBox.width),this.zoomBox.height=Math.ceil(this.zoomBox.height),this.zoomBox.aspectRatio=this.zoomBox.width/this.zoomBox.height,this.zoomBox.node.jSetCss({width:this.zoomBox.width,height:this.zoomBox.height}),t&&(s=this.expanded?this.expandBox.jGetSize():this.zoomBox.node.jGetSize(),!this.expanded&&this.normalSize.width*this.normalSize.height/(this.zoomSizeOrigin.width*this.zoomSizeOrigin.height)>.8?(this.zoomSize.width=1.5*this.zoomSizeOrigin.width,this.zoomSize.height=1.5*this.zoomSizeOrigin.height):this.zoomSize=m.detach(this.zoomSizeOrigin)),this.zoomBox.mode===!1||this.zoomBox.active||this.expanded&&"always"===this.option("expandZoomOn")||(this.normalSize.width*this.normalSize.height/(this.zoomSize.width*this.zoomSize.height)>.8?(this.zoomSize=m.detach(this.zoomSizeOrigin),
this.zoomBox.enable(!1)):this.zoomBox.enable(!0)),this.zoomBox.image.jSetCss({width:this.zoomSize.width,height:this.zoomSize.height}),i=this.zoomBox.node.getInnerSize(),this.zoomBox.innerWidth=Math.ceil(i.width),this.zoomBox.innerHeight=Math.ceil(i.height),this.lens.width=Math.ceil(this.zoomBox.innerWidth/(this.zoomSize.width/this.size.width)),this.lens.height=Math.ceil(this.zoomBox.innerHeight/(this.zoomSize.height/this.size.height)),this.lens.node.jSetCss({width:this.lens.width,height:this.lens.height}),this.lens.image.jSetCss(this.size),m.extend(this.lens,this.lens.node.jGetSize()),this.zoomBox.active&&(clearTimeout(this.moveTimer),this.moveTimer=null,this.lens.innertouch?(this.lens.pos.x*=this.size.width/a.width,this.lens.pos.y*=this.size.height/a.height,r.x=this.lens.spos.x,r.y=this.lens.spos.y):(r.x=this.boundaries.left+this.lens.width/2+this.lens.pos.x*(this.size.width/a.width),r.y=this.boundaries.top+this.lens.height/2+this.lens.pos.y*(this.size.height/a.height)),this.animate(null,r))},reflowZoom:function(t){var e,o,n,s,a,r,h=c(this.node).jFetch("cr");if(n=i(5),a=this.zoomBox.position,s=this.expanded?"inner":this.zoomBox.custom?"custom":this.option("zoom-position"),r=this.expanded&&"zoom"===this.zoomBox.mode?this.expandBox:document.body,this.expanded&&(n.y=0,n.x=0),t||this.setSize(!0,s),e=this.boundaries.top,"magnifier"!==this.zoomBox.mode){if(t)return void this.setSize(!1);switch(s){case"inner":case"custom":e=0,o=0;break;case"top":e=this.boundaries.top-this.zoomBox.height-this.option("zoom-distance"),n.top>e&&(e=this.boundaries.bottom+this.option("zoom-distance"),s="bottom"),o=this.boundaries.left;break;case"bottom":e=this.boundaries.bottom+this.option("zoom-distance"),n.bottom<e+this.zoomBox.height&&(e=this.boundaries.top-this.zoomBox.height-this.option("zoom-distance"),s="top"),o=this.boundaries.left;break;case"left":o=this.boundaries.left-this.zoomBox.width-this.option("zoom-distance"),n.left>o&&n.right>=this.boundaries.right+this.option("zoom-distance")+this.zoomBox.width&&(o=this.boundaries.right+this.option("zoom-distance"),s="right");break;case"right":default:o=this.boundaries.right+this.option("zoom-distance"),n.right<o+this.zoomBox.width&&n.left<=this.boundaries.left-this.zoomBox.width-this.option("zoom-distance")&&(o=this.boundaries.left-this.zoomBox.width-this.option("zoom-distance"),s="left")}switch(this.option("zoom-position")){case"top":case"bottom":(n.top>e||n.bottom<e+this.zoomBox.height)&&(s="inner");break;case"left":case"right":(n.left>o||n.right<o+this.zoomBox.width)&&(s="inner")}if(this.zoomBox.position=s,!this.zoomBox.activating&&!this.zoomBox.active)return void(m.browser.mobile&&!this.expanded&&"zoom"===this.zoomBox.mode&&(this.option("expand")?this.zoomBox.enable("inner"!==s):"click"!==this.option("zoomOn")&&(this.zoomBox.trigger="inner"===s?"click":this.option("zoomOn"),this.unregisterActivateEvent(),this.unregisterDeactivateEvent(),this.registerActivateEvent("click"===this.zoomBox.trigger),this.registerDeactivateEvent("click"===this.zoomBox.trigger&&!this.option("expand"))),this.showHint(!1,null,!0)));if(this.setSize(!1),t)return;"custom"===s&&(r=this.zoomBox.custom,n.y=0,n.x=0),"inner"===s?("preview"!==this.zoomBox.mode&&(this.zoomBox.node.jAddClass("mz-inner"),this.node.jAddClass("mz-inner-zoom")),this.lens.hide(),e=this.boundaries.top+n.y,o=this.boundaries.left+n.x,!this.expanded&&m.browser.ieMode&&m.browser.ieMode<11&&(e=0,o=0,r=this.node)):(e+=n.y,o+=n.x,this.node.jRemoveClass("mz-inner-zoom"),this.zoomBox.node.jRemoveClass("mz-inner")),this.zoomBox.node.jSetCss({top:e,left:o})}else this.setSize(!1),r=this.node;this.zoomBox.node[this.expanded?"jAddClass":"jRemoveClass"]("mz-expanded"),!this.expanded&&h&&h.jAppendTo("zoom"===this.zoomBox.mode&&"inner"===s?this.zoomBox.node:this.node,(Math.floor(101*Math.random())+1)%2?"top":"bottom"),this.zoomBox.node.jAppendTo(r)},changeZoomLevel:function(t){var e,i,o,n,s=!1,a=t.isMouse?5:3/54;if(c(t).stop(),a=(100+a*Math.abs(t.deltaY))/100,t.deltaY<0&&(a=1/a),"magnifier"===this.zoomBox.mode)i=Math.max(100,Math.round(this.zoomBox.width*a)),i=Math.min(i,.9*this.size.width),o=i/this.zoomBox.aspectRatio,this.zoomBox.width=Math.ceil(i),this.zoomBox.height=Math.ceil(o),this.zoomBox.node.jSetCss({width:this.zoomBox.width,height:this.zoomBox.height}),e=this.zoomBox.node.getInnerSize(),this.zoomBox.innerWidth=Math.ceil(e.width),this.zoomBox.innerHeight=Math.ceil(e.height),s=!0;else{if(this.expanded||"zoom"!==this.zoomBox.mode)return;i=Math.max(50,Math.round(this.lens.width*a)),i=Math.min(i,.9*this.size.width),o=i/this.zoomBox.aspectRatio,this.zoomSize.width=Math.ceil(this.zoomBox.innerWidth/i*this.size.width),this.zoomSize.height=Math.ceil(this.zoomBox.innerHeight/o*this.size.height),this.zoomBox.image.jSetCss({width:this.zoomSize.width,height:this.zoomSize.height})}n=c(window).jGetScroll(),this.lens.width=Math.ceil(this.zoomBox.innerWidth/(this.zoomSize.width/this.size.width)),this.lens.height=Math.ceil(this.zoomBox.innerHeight/(this.zoomSize.height/this.size.height)),this.lens.node.jSetCss({width:this.lens.width,height:this.lens.height}),m.extend(this.lens,this.lens.node.jGetSize()),this.zoomBox.active&&(clearTimeout(this.moveTimer),this.moveTimer=null,s&&(this.moveTimer=!0),this.animate(null,{x:t.x-n.x,y:t.y-n.y}),s&&(this.moveTimer=null))},registerActivateEvent:function(t){var e,i=t?"dbltap btnclick":"touchstart"+(window.navigator.pointerEnabled?" pointerdown":window.navigator.msPointerEnabled?" MSPointerDown":"")+(window.navigator.pointerEnabled?" pointermove":window.navigator.msPointerEnabled?" MSPointerMove":" mousemove"),s=this.node.jFetch("mz:handlers:activate:fn",t?c(this.activate).jBindAsEvent(this):c(function(t){(!o(t)||n(t))&&(t&&"touch"===t.pointerType&&"pointerdown"!==t.type||(e=m.browser.ieMode<9?m.extend({},t):t,this.activateTimer||(clearTimeout(this.activateTimer),this.activateTimer=setTimeout(c(function(){this.activate(e)}).jBind(this),120))))}).jBindAsEvent(this));this.node.jStore("mz:handlers:activate:event",i).jAddEvent(i,s,10)},unregisterActivateEvent:function(){var t=this.node.jFetch("mz:handlers:activate:event"),e=this.node.jFetch("mz:handlers:activate:fn");this.node.jRemoveEvent(t,e),this.node.jDel("mz:handlers:activate:fn")},registerDeactivateEvent:function(t){var e=t?"dbltap btnclick":"touchend"+(window.navigator.pointerEnabled?" pointerup pointerout pointermove":window.navigator.msPointerEnabled?" MSPointerUp MSPointerOut MSPointerMove":" mouseout mousemove"),i=this.node.jFetch("mz:handlers:deactivate:fn",c(function(t){if((!o(t)||n(t))&&(!t||"pointerup"!==t.type||"touch"===t.pointerType))if(!t||"pointermove"!==t.type&&"MSPointerMove"!==t.type&&"mousemove"!==t.type){if(this.zoomBox.node!==t.getRelated()&&("inner"!==this.zoomBox.position&&"magnifier"!==this.zoomBox.mode||!this.zoomBox.node.hasChild(t.getRelated()))&&!this.node.hasChild(t.getRelated()))return void this.deactivate(t)}else{if(!this.ready||!this.zoomBox.enabled||!this.zoomBox.active)return;var e=t.getClientXY();if(e.x<this.boundaries.left||e.x>this.boundaries.right||e.y<this.boundaries.top||e.y>this.boundaries.bottom)return void this.deactivate(t)}}).jBindAsEvent(this));this.node.jStore("mz:handlers:deactivate:event",e).jAddEvent(e,i,20)},unregisterDeactivateEvent:function(){var t=this.node.jFetch("mz:handlers:deactivate:event"),e=this.node.jFetch("mz:handlers:deactivate:fn");this.node.jRemoveEvent(t,e),this.node.jDel("mz:handlers:deactivate:fn")},registerEvents:function(){this.moveBind=this.move.jBind(this),this.node.jAddEvent(["touchstart",window.navigator.pointerEnabled?"pointerdown":"MSPointerDown"],c(function(t){(m.browser.androidBrowser||"android"===m.browser.platform&&m.browser.gecko)&&this.option("zoomMode")&&"click"!==this.option("zoomOn")&&"touchstart"===t.type&&(t.stopDefaults(),m.browser.gecko&&t.stopDistribution()),this.zoomBox.active&&"inner"===this.zoomBox.position&&(this.lens.spos=t.getClientXY())}).jBindAsEvent(this),10),this.node.jAddEvent(["touchend",window.navigator.pointerEnabled?"pointerup":"MSPointerUp"],c(function(t){o(t)&&n(t)&&(this.lens.touchmovement=!1)}).jBindAsEvent(this),10),this.node.jAddEvent("touchmove "+("android"===m.browser.platform?"":window.navigator.pointerEnabled?"pointermove":window.navigator.msPointerEnabled?"MSPointerMove":"mousemove"),c(this.animate).jBindAsEvent(this)),this.option("zoomMode")&&(this.registerActivateEvent("click"===this.option("zoomOn")),this.registerDeactivateEvent("click"===this.option("zoomOn")&&!this.option("expand"))),this.node.jAddEvent("mousedown",function(t){t.stopDistribution()},10).jAddEvent("btnclick",c(function(t){this.node.jRaiseEvent("MouseEvent","click"),this.expanded&&this.expandBox.jCallEvent("btnclick",t)}).jBind(this),15),this.option("expand")?this.node.jAddEvent("tap btnclick",c(this.expand).jBindAsEvent(this),15):this.node.jAddEvent("tap btnclick",c(this.openLink).jBindAsEvent(this),15),this.additionalImages.length>1&&this.swipe(),!m.browser.mobile&&this.option("variableZoom")&&this.node.jAddEvent("mousescroll",this.changeZoomLevel.jBindAsEvent(this)),c(window).jAddEvent(m.browser.mobile?"resize":"resize scroll",this.onResize)},unregisterEvents:function(){this.node&&this.node.jRemoveEvent("mousescroll"),c(window).jRemoveEvent("resize scroll",this.onResize),c(this.additionalImages).jEach(function(t){c(t.origin).jClearEvents()})},activate:function(t){var e,i,n,r,h,d=0,l=0;if(!this.image.loaded()||!this.ready||!this.zoomBox.enabled||this.zoomBox.active||this.zoomBox.activating)return void(this.image.loaded()||this.initEvent||(t&&(this.initEvent=s(t),t.stopQueue()),this.image.load(this.setupZoom.jBind(this)),this.loadTimer||(this.loadTimer=c(this.showLoading).jBind(this).jDelay(400))));if(!t||"pointermove"!==t.type||"touch"!==t.pointerType){if(!this.option("zoomMode")&&this.option("expand")&&!this.expanded)return void(this.zoomBox.active=!0);this.zoomBox.activating=!0,this.expanded&&"zoom"===this.zoomBox.mode&&(r=this.image.node.jGetRect(),this.expandStage.jAddClass("mz-zoom-in"),h=this.expandFigure.jGetRect(),l=(r.left+r.right)/2-(h.left+h.right)/2,d=(r.top+r.bottom)/2-(h.top+h.bottom)/2),this.zoomBox.image.jRemoveEvent("transitionend"),this.zoomBox.node.jRemoveClass("mz-deactivating").jRemoveEvent("transitionend"),this.zoomBox.node.jAddClass("mz-activating"),this.node.jAddClass("mz-activating"),this.reflowZoom(),i="zoom"===this.zoomBox.mode?this.zoomBox.position:this.zoomBox.mode,!m.browser.features.transition||this.expanded&&"always"===this.option("expandZoomOn")?(this.zoomBox.node.jRemoveClass("mz-activating"),this.zoomBox.activating=!1,this.zoomBox.active=!0):"inner"===i?(n=this.image.node.jGetSize(),this.zoomBox.image.jSetCss({transform:"translate3d(0,"+d+"px, 0) scale("+n.width/this.zoomSize.width+", "+n.height/this.zoomSize.height+")"}).jGetSize(),this.zoomBox.image.jAddEvent("transitionend",c(function(){this.zoomBox.image.jRemoveEvent("transitionend"),this.zoomBox.node.jRemoveClass("mz-activating mz-p-"+i),this.zoomBox.activating=!1,this.zoomBox.active=!0}).jBind(this)),this.zoomBox.node.jAddClass("mz-p-"+i).jGetSize(),m.browser.mobile||!m.browser.chrome||"chrome"!==m.browser.uaName&&"opera"!==m.browser.uaName||(this.zoomBox.activating=!1,this.zoomBox.active=!0)):(this.zoomBox.node.jAddEvent("transitionend",c(function(){this.zoomBox.node.jRemoveEvent("transitionend"),this.zoomBox.node.jRemoveClass("mz-activating mz-p-"+i)}).jBind(this)),this.zoomBox.node.jSetCss({transition:"none"}),this.zoomBox.node.jAddClass("mz-p-"+i).jGetSize(),this.zoomBox.node.jSetCss({transition:""}).jGetSize(),this.zoomBox.node.jRemoveClass("mz-p-"+i),this.zoomBox.activating=!1,this.zoomBox.active=!0),this.expanded||this.showHint(!0),t?(t.stop().stopQueue(),e=t.getClientXY(),"magnifier"===this.zoomBox.mode&&/tap/i.test(t.type)&&(e.y-=this.zoomBox.height/2+10),"inner"===i&&(/tap/i.test(t.type)||o(t))&&(this.lens.pos={x:0,y:0},e.x=-(e.x-this.boundaries.left-this.size.width/2)*(this.zoomSize.width/this.size.width),e.y=-(e.y-this.boundaries.top-this.size.height/2)*(this.zoomSize.height/this.size.height))):(e={x:this.boundaries.left+(this.boundaries.right-this.boundaries.left)/2,y:this.boundaries.top+(this.boundaries.bottom-this.boundaries.top)/2},m.browser.mobile&&this.expanded&&"always"===this.option("expandZoomOn")&&(this.lens.innertouch=!0,this.lens.pos={x:0,y:0},e.x=-(e.x-this.boundaries.left-this.size.width/2)*(this.zoomSize.width/this.size.width),e.y=-(e.y-this.boundaries.top-this.size.height/2)*(this.zoomSize.height/this.size.height))),this.node.jRemoveClass("mz-activating").jAddClass("mz-active"),e.x+=-l,e.y+=-d,this.lens.spos={x:0,y:0},this.lens.dx=0,this.lens.dy=0,this.animate(t,e,!0),a("onZoomIn",this.id)}},deactivate:function(t,e){var i,o,n,s,r=0,h=0,d=this.zoomBox.active;this.initEvent=null,this.ready&&(t&&"pointerout"===t.type&&"touch"===t.pointerType||(clearTimeout(this.moveTimer),this.moveTimer=null,clearTimeout(this.activateTimer),this.activateTimer=null,this.zoomBox.activating=!1,this.zoomBox.active=!1,e===!0||this.expanded||d&&(m.browser.mobile&&!this.expanded&&"zoom"===this.zoomBox.mode?this.reflowZoom():this.showHint()),this.zoomBox.enabled&&(t&&t.stop(),this.zoomBox.image.jRemoveEvent("transitionend"),this.zoomBox.node.jRemoveClass("mz-activating").jRemoveEvent("transitionend"),this.expanded&&(s=this.expandFigure.jGetRect(),"always"!==this.option("expandZoomOn")&&this.expandStage.jRemoveClass("mz-zoom-in"),this.image.node.jSetCss({"max-height":this.expandMaxHeight()}),n=this.image.node.jGetRect(),h=(n.left+n.right)/2-(s.left+s.right)/2,r=(n.top+n.bottom)/2-(s.top+s.bottom)/2),i="zoom"===this.zoomBox.mode?this.zoomBox.position:this.zoomBox.mode,!m.browser.features.transition||!t||this.expanded&&"always"===this.option("expandZoomOn")?(this.zoomBox.hide(),this.node.jRemoveClass("mz-active")):"inner"===i?(this.zoomBox.image.jAddEvent("transitionend",c(function(){this.zoomBox.image.jRemoveEvent("transitionend"),this.node.jRemoveClass("mz-active"),setTimeout(c(function(){this.zoomBox.hide()}).jBind(this),32)}).jBind(this)),o=this.image.node.jGetSize(),this.zoomBox.node.jAddClass("mz-deactivating mz-p-"+i).jGetSize(),this.zoomBox.image.jSetCss({transform:"translate3d(0,"+r+"px,0) scale("+o.width/this.zoomSize.width+", "+o.height/this.zoomSize.height+")"})):(this.zoomBox.node.jAddEvent("transitionend",c(function(){this.zoomBox.hide(),this.node.jRemoveClass("mz-active")}).jBind(this)),this.zoomBox.node.jGetCss("opacity"),this.zoomBox.node.jAddClass("mz-deactivating mz-p-"+i),this.node.jRemoveClass("mz-active")),this.lens.dx=0,this.lens.dy=0,this.lens.spos={x:0,y:0},this.lens.hide(),d&&a("onZoomOut",this.id))))},animate:function(t,e,i){var s,a,r,h,d=e,l=0,u=0,p=!1;if(this.zoomBox.active||i){if(t){if(c(t).stopDefaults().stopDistribution(),o(t)&&!n(t))return;p=/tap/i.test(t.type)||o(t),p&&!this.lens.touchmovement&&(this.lens.touchmovement=p),d||(d=t.getClientXY())}"preview"!==this.zoomBox.mode&&("zoom"===this.zoomBox.mode&&"inner"===this.zoomBox.position&&(t&&p||!t&&this.lens.innertouch)?(this.lens.innertouch=!0,s=this.lens.pos.x+(d.x-this.lens.spos.x),a=this.lens.pos.y+(d.y-this.lens.spos.y),this.lens.spos=d,l=Math.min(0,this.zoomBox.innerWidth-this.zoomSize.width)/2,r=-l,u=Math.min(0,this.zoomBox.innerHeight-this.zoomSize.height)/2,h=-u):(this.lens.innertouch=!1,"magnifier"===this.zoomBox.mode&&(d.y=Math.max(this.boundaries.top,Math.min(d.y,this.boundaries.bottom)),d.x=Math.max(this.boundaries.left,Math.min(d.x,this.boundaries.right))),s=d.x-this.boundaries.left,a=d.y-this.boundaries.top,r=this.size.width-this.lens.width,h=this.size.height-this.lens.height,s-=this.lens.width/2,a-=this.lens.height/2),"magnifier"!==this.zoomBox.mode&&(s=Math.max(l,Math.min(s,r)),a=Math.max(u,Math.min(a,h))),this.lens.pos.x=s=Math.round(s),this.lens.pos.y=a=Math.round(a),"zoom"===this.zoomBox.mode&&"inner"!==this.zoomBox.position&&(m.browser.features.transform?(this.lens.node.jSetCss({transform:"translate("+this.lens.pos.x+"px,"+this.lens.pos.y+"px)"}),this.lens.image.jSetCss({transform:"translate("+-(this.lens.pos.x+this.lens.border.x)+"px, "+-(this.lens.pos.y+this.lens.border.y)+"px)"})):(this.lens.node.jSetCss({top:this.lens.pos.y,left:this.lens.pos.x}),this.lens.image.jSetCss({top:-(this.lens.pos.y+this.lens.border.y),left:-(this.lens.pos.x+this.lens.border.x)}))),"magnifier"===this.zoomBox.mode&&(!this.lens.touchmovement||t&&"dbltap"===t.type||(d.y-=this.zoomBox.height/2+10),this.zoomBox.node.jSetCss({top:d.y-this.boundaries.top-this.zoomBox.height/2,left:d.x-this.boundaries.left-this.zoomBox.width/2})),this.moveTimer||(this.lens.dx=0,this.lens.dy=0,this.move(1)))}},move:function(t){var e,i,o,n;isFinite(t)||(t=this.lens.innertouch?this.lens.touchmovement?.4:.16:this.option("smoothing")?.2:this.lens.touchmovement?.4:.8),e=(this.lens.pos.x-this.lens.dx)*t,i=(this.lens.pos.y-this.lens.dy)*t,this.lens.dx+=e,this.lens.dy+=i,(!this.moveTimer||Math.abs(e)>1e-6||Math.abs(i)>1e-6)&&(this.lens.innertouch?(o=this.lens.dx,n=this.lens.dy):(o=this.lens.dx*(this.zoomSize.width/this.size.width)-Math.max(0,this.zoomSize.width-this.zoomBox.innerWidth)/2,n=this.lens.dy*(this.zoomSize.height/this.size.height)-Math.max(0,this.zoomSize.height-this.zoomBox.innerHeight)/2,"magnifier"===this.zoomBox.mode&&(o=Math.round(o),n=Math.round(n)),o=-o,n=-n),this.zoomBox.image.jSetCss(m.browser.features.transform?{transform:B+o+"px,"+n+"px"+T+" scale(1)"}:{left:-(this.lens.dx*(this.zoomSize.width/this.size.width)+Math.min(0,this.zoomSize.width-this.zoomBox.innerWidth)/2),top:-(this.lens.dy*(this.zoomSize.height/this.size.height)+Math.min(0,this.zoomSize.height-this.zoomBox.innerHeight)/2)})),"magnifier"!==this.zoomBox.mode&&(this.moveTimer=setTimeout(this.moveBind,16))},swipe:function(){var t,e,i,o,n,s,a,r=30,h=201,d="",l={},u=0,p={transition:m.browser.cssTransform+String.fromCharCode(32)+"300ms cubic-bezier(.18,.35,.58,1)"},g=c(function(m){if(this.ready&&!this.zoomBox.active)if("dragstart"===m.state)clearTimeout(this.activateTimer),this.activateTimer=null,u=0,l={x:m.x,y:m.y,ts:m.timeStamp},t=this.size.width,e=t/2,this.image.node.jRemoveEvent("transitionend"),this.image.node.jSetCssProp("transition",""),this.image.node.jSetCssProp("transform","translate3d(0, 0, 0)"),a=null;else{if(o=m.x-l.x,n={x:0,y:0,z:0},null===a&&(a=Math.abs(m.x-l.x)<Math.abs(m.y-l.y)),a)return;if(m.stop(),"dragend"===m.state)return u=0,s=null,i=m.timeStamp-l.ts,(Math.abs(o)>e||h>i&&Math.abs(o)>r)&&(d=o>0?"backward":0>=o?"forward":"")&&("backward"===d?(s=this.getPrev(),u+=10*t):(s=this.getNext(),u-=10*t)),n.x=u,n.deg=-90*(n.x/t),this.image.node.jAddEvent("transitionend",c(function(t){this.image.node.jRemoveEvent("transitionend"),this.image.node.jSetCssProp("transition",""),s&&(this.image.node.jSetCss({transform:"translate3d("+n.x+"px, 0px, 0px)"}),this.update(s,!0))}).jBind(this)),this.image.node.jSetCss(p),this.image.node.jSetCss({"transition-duration":n.x?"100ms":"300ms",opacity:1-.7*Math.abs(n.x/t),transform:"translate3d("+n.x+"px, 0px, 0px)"}),void(o=0);n.x=o,n.z=-50*Math.abs(n.x/e),n.deg=-60*(n.x/e),this.image.node.jSetCss({opacity:1-.7*Math.abs(n.x/e),transform:"translate3d("+n.x+"px, 0px, "+n.z+"px)"})}}).jBind(this);this.node.jAddEvent("touchdrag",g)},setupExpandGallery:function(){var t,i;this.additionalImages.length?this.expandGallery=this.additionalImages:(t=this.placeholder.getAttribute("data-gallery"),t&&(i=m.browser.features.query?m.$A(document.querySelectorAll('.MagicZoom[data-gallery="'+t+'"], .MagicZoomPlus[data-gallery="'+t+'"]')):m.$A(document.getElementsByTagName("A")).filter(function(e){return t===e.getAttribute("data-gallery")}),c(i).jEach(function(t){var i,o;i=e(t),i&&i.additionalImages.length>0||(i?(o=new O(i.image.small.url,i.image.zoom.url,i.image.caption,null,i.image.origin),o.link=i.image.link):o=(new O).parseNode(t,i?i.originalTitle:null),this.image.zoom.src.has(o.zoom.url)&&this.image.small.src.has(o.small.url)&&(o=this.image),this.expandGallery.push(o))},this),this.primaryImage=this.image)),this.expandGallery.length>1?(this.expandStage.jAddClass("with-thumbs"),this.expandNav=m.$new("div",{"class":"mz-expand-thumbnails"}).jAppendTo(this.expandStage),this.expandThumbs=new u(this.expandNav),c(this.expandGallery).jEach(function(t){var e=c(function(e){this.setActiveThumb(t),this.update(t)}).jBind(this);t.selector=this.expandThumbs.addItem(m.$new("img",{src:t.getURL("small")}).jAddEvent("tap btnclick",function(t){t.stop()}).jAddEvent("tap "+("hover"===this.option("selectorTrigger")?"mouseover mouseout":"btnclick"),c(function(t,i){this.updateTimer&&clearTimeout(this.updateTimer),this.updateTimer=!1,"mouseover"===t.type?this.updateTimer=c(e).jDelay(i):("tap"===t.type||"btnclick"===t.type)&&e()}).jBindAsEvent(this,60)))},this),this.buttons.next.show(),this.buttons.prev.show()):(this.expandStage.jRemoveClass("with-thumbs"),this.buttons.next.hide(),this.buttons.prev.hide())},destroyExpandGallery:function(){var t;if(this.expandThumbs&&(this.expandThumbs.stop(),this.expandThumbs=null),this.expandNav&&(this.expandNav.jRemove(),this.expandNav=null),this.expandGallery.length>1&&!this.additionalImages.length)for(this.node.jRemoveEvent("touchdrag"),this.image.node.jRemove().getAttribute("style"),this.image.node.removeAttribute("style"),this.primaryImage.node.jAppendTo(this.node),this.setupZoom(this.primaryImage);t=this.expandGallery.pop();)t!==this.primaryImage&&(t.small.node&&(t.small.node.kill(),t.small.node=null),t.zoom.node&&(t.zoom.node.kill(),t.zoom.node=null),t=null);this.expandGallery=[]},close:function(){this.ready&&this.expanded&&("ios"===m.browser.platform&&"safari"===m.browser.uaName&&7===parseInt(m.browser.uaVersion)&&(clearInterval(A),A=null),c(document).jRemoveEvent("keydown",this.keyboardCallback),this.deactivate(null,!0),this.ready=!1,m.browser.fullScreen.capable&&m.browser.fullScreen.enabled()?m.browser.fullScreen.cancel():m.browser.features.transition?(this.node.jRemoveEvent("transitionend").jSetCss({transition:""}),this.node.jAddEvent("transitionend",this.onClose),m.browser.webkit&&setTimeout(c(function(){this.onClose()}).jBind(this),260),this.expandBg.jRemoveEvent("transitionend").jSetCss({transition:""}),this.expandBg.jSetCss({transition:"all 0.6s cubic-bezier(0.895, 0.030, 0.685, 0.220) 0.0s"}).jGetSize(),this.node.jSetCss({transition:"all .3s cubic-bezier(0.600, 0, 0.735, 0.045) 0s"}).jGetSize(),this.zoomBox.mode!==!1&&"always"===this.option("expandZoomOn")&&"magnifier"!==this.option("expandZoomMode")&&(this.image.node.jSetCss({"max-height":this.image.jGetSize("zoom").height}),this.image.node.jSetCss({"max-width":this.image.jGetSize("zoom").width})),this.expandBg.jSetCss({opacity:.4}),this.node.jSetCss({opacity:.01,transform:"scale(0.4)"})):this.onClose())},expand:function(t){if(!this.image.loaded()||!this.ready||this.expanded)return void(this.image.loaded()||(t&&(this.initEvent=s(t),t.stopQueue(),"tap"===t.type&&t.events[1].stopQueue()),this.image.load(this.setupZoom.jBind(this)),this.loadTimer||(this.loadTimer=c(this.showLoading).jBind(this).jDelay(400))));t&&t.stopQueue();var e=c(this.node).jFetch("cr"),i=document.createDocumentFragment();this.hideHint(),this.hintRuns--,this.deactivate(null,!0),this.unregisterActivateEvent(),this.unregisterDeactivateEvent(),this.ready=!1,this.expandBox||(this.expandBox=m.$new("div").jAddClass("mz-expand").jAddClass(this.option("cssClass")).jSetCss({opacity:0}),this.expandStage=m.$new("div").jAddClass("mz-expand-stage").jAppendTo(this.expandBox),this.expandControls=m.$new("div").jAddClass("mz-expand-controls").jAppendTo(this.expandStage),c(["prev","next","close"]).jEach(function(t){var e="mz-button";switch(this.buttons[t]=m.$new("button",{title:this.option("text-btn-"+t)}).jAddClass(e).jAddClass(e+"-"+t),i.appendChild(this.buttons[t]),t){case"prev":this.buttons[t].jAddEvent("tap btnclick",function(t){t.stop(),this.update(this.getPrev())}.jBindAsEvent(this));break;case"next":this.buttons[t].jAddEvent("tap btnclick",function(t){t.stop(),this.update(this.getNext())}.jBindAsEvent(this));break;case"close":this.buttons[t].jAddEvent("tap btnclick",function(t){t.stop(),this.close()}.jBindAsEvent(this))}},this),this.expandControls.append(i),this.expandBox.jAddEvent("mousescroll touchstart dbltap",c(function(t){c(t).stop()})),this.option("closeOnClickOutside")&&this.expandBox.jAddEvent("tap btnclick",function(t){var e=t.jGetPageXY(),i=c("magnifier"===this.option("expandZoomMode")?this.zoomBox.node:this.zoomBox.image).jGetRect();return"always"!==this.option("expandZoomOn")&&i.top<=e.y&&e.y<=i.bottom&&i.left<=e.x&&e.x<=i.right?(t.stopQueue(),void this.deactivate(t)):void("always"!==this.option("expandZoomOn")&&this.node.hasChild(t.getOriginalTarget())||(t.stop(),this.close()))}.jBindAsEvent(this)),this.keyboardCallback=c(function(t){var e=null;(27===t.keyCode||37===t.keyCode||39===t.keyCode)&&(c(t).stop(),27===t.keyCode?this.close():(e=37===t.keyCode?this.getPrev():this.getNext(),e&&this.update(e)))}).jBindAsEvent(this),this.onExpand=c(function(){this.node.jRemoveEvent("transitionend").jSetCss({transition:"",transform:"translate3d(0, 0, 0)"}),this.expanded||(this.expanded=!0,this.expandBox.jRemoveClass("mz-expand-opening").jSetCss({opacity:1}),this.zoomBox.setMode(this.option("expandZoomMode")),this.zoomSize=m.detach(this.zoomSizeOrigin),this.resizeCallback(),this.expandCaption&&this.image.caption&&(this.image.link?this.expandCaption.append(m.$new("a",{href:this.image.link}).jAddEvent("tap btnclick",this.openLink.jBind(this)).changeContent(this.image.caption)):this.expandCaption.changeContent(this.image.caption),this.expandCaption.jAddClass("mz-show")),"always"!==this.option("expandZoomOn")&&(this.registerActivateEvent(!0),this.registerDeactivateEvent(!0)),this.ready=!0,"always"===this.option("expandZoomOn")&&(this.zoomBox.mode!==!1&&this.zoomBox.enable(!0),m.browser.mobile&&this.mobileZoomHint&&(this.mobileZoomHint=!1),this.activate()),(m.browser.mobile||this.option("forceTouch"))&&this.zoomBox.enabled&&((this.mobileZoomHint||this.hintRuns>0)&&this.showHint(!0,this.option("textClickZoomHint")),this.mobileZoomHint=!1),this.expandControls.jRemoveClass("mz-hidden").jAddClass("mz-fade mz-visible"),this.expandNav&&this.expandNav.jRemoveClass("mz-hidden").jAddClass("mz-fade mz-visible"),this.expandThumbs&&(this.expandThumbs.run(),this.setActiveThumb(this.image)),e&&e.jAppendTo(this.expandBox,(Math.floor(101*Math.random())+1)%2?"top":"bottom"),this.expandGallery.length&&!this.additionalImages.length&&this.swipe(),c(document).jAddEvent("keydown",this.keyboardCallback),"ios"===m.browser.platform&&"safari"===m.browser.uaName&&7===parseInt(m.browser.uaVersion)&&(A=h()),a("onExpandOpen",this.id))}).jBind(this),this.onClose=c(function(){this.node.jRemoveEvent("transitionend"),this.expanded&&(this.expanded&&(c(document).jRemoveEvent("keydown",this.keyboardCallback),this.deactivate(null,!0)),this.destroyExpandGallery(),this.expanded=!1,this.zoomBox.setMode(this.option("zoomMode")),this.node.replaceChild(this.image.getNode("small"),this.image.node),this.image.setCurNode("small"),c(this.image.node).jSetCss({width:"",height:"","max-width":Math.min(this.image.jGetSize("small").width),"max-height":Math.min(this.image.jGetSize("small").height)}),this.lens.image.src=this.image.getURL("small"),this.node.jSetCss({opacity:"",transition:""}),this.node.jSetCss({transform:"translate3d(0, 0, 0)"}),c(this.placeholder).replaceChild(this.node,this.stubNode),this.setSize(!0),this.expandCaption&&(this.expandCaption.jRemove(),this.expandCaption=null),this.unregisterActivateEvent(),this.unregisterDeactivateEvent(),"always"===this.option("zoomOn")?this.activate():this.option("zoomMode")!==!1&&(this.registerActivateEvent("click"===this.option("zoomOn")),this.registerDeactivateEvent("click"===this.option("zoomOn")&&!this.option("expand"))),this.showHint(),this.expandBg.jRemoveEvent("transitionend"),this.expandBox.jRemove(),this.expandBg.jRemove(),this.expandBg=null,c(m.browser.getDoc()).jRemoveClass("mz-expanded-view-open"),this.ready=!0,m.browser.ieMode<10?this.resizeCallback():c(window).jRaiseEvent("UIEvent","resize"),a("onExpandClose",this.id))}).jBind(this),this.expandImageStage=m.$new("div",{"class":"mz-image-stage"}).jAppendTo(this.expandStage),this.expandFigure=m.$new("figure").jAppendTo(this.expandImageStage),this.stubNode=this.node.cloneNode(!1)),this.setupExpandGallery(),c(m.browser.getDoc()).jAddClass("mz-expanded-view-open"),c(document.body).jGetSize(),"fullscreen"===this.option("expand")?(this.prepareExpandedView(),m.browser.fullScreen.request(this.expandBox,{onEnter:c(function(){this.onExpand()}).jBind(this),onExit:this.onClose,fallback:c(function(){this.expandToWindow()}).jBind(this)})):setTimeout(c(function(){this.prepareExpandedView(),this.expandToWindow()}).jBind(this),96)},prepareExpandedView:function(){var t,e;t=m.$new("img",{src:this.image.getURL("zoom")}),this.expandBg=m.$new("div").jAddClass("mz-expand-bg").append(m.browser.features.cssFilters||m.browser.ieMode<10?t:new m.SVGImage(t).blur(b).getNode()).jAppendTo(this.expandBox),"always"===this.option("expandZoomOn")&&this.option("expandZoomMode")!==!1&&this.expandStage.jAddClass("mz-always-zoom"+("zoom"===this.option("expandZoomMode")?" mz-zoom-in":"")).jGetSize(),e=c(this.node)[m.browser.ieMode<10?"jGetSize":"getBoundingClientRect"](),c(this.stubNode).jSetCss({width:e.width,height:e.height}),this.node.replaceChild(this.image.getNode("zoom"),this.image.node),this.image.setCurNode("zoom"),this.expandBox.jAppendTo(document.body),this.expandMaxWidth=function(){var t=this.expandImageStage;return c(this.expandFigure).jGetSize().width>50&&(t=this.expandFigure),function(){return"always"===this.option("expandZoomOn")&&this.option("expandZoomMode")!==!1&&"magnifier"!==this.option("expandZoomMode")?1/0:Math.round(c(t).getInnerSize().width)}}.call(this),this.expandMaxHeight=function(){var t=this.expandImageStage;return c(this.expandFigure).jGetSize().height>50&&(t=this.expandFigure),function(){return"always"===this.option("expandZoomOn")&&this.option("expandZoomMode")!==!1&&"magnifier"!==this.option("expandZoomMode")?1/0:Math.round(c(t).getInnerSize().height)}}.call(this),this.expandControls.jRemoveClass("mz-fade mz-visible").jAddClass("mz-hidden"),this.expandNav&&this.expandNav.jRemoveClass("mz-fade mz-visible").jAddClass("mz-hidden"),this.image.node.jSetCss({"max-height":Math.min(this.image.jGetSize("zoom").height,this.expandMaxHeight())}),this.image.node.jSetCss({"max-width":Math.min(this.image.jGetSize("zoom").width,this.expandMaxWidth())}),this.expandFigure.append(c(this.placeholder).replaceChild(this.stubNode,this.node)),this.option("expandCaption")&&(this.expandCaption=m.$new("figcaption",{"class":"mz-caption"}).jAppendTo(this.expandFigure))},expandToWindow:function(){this.node.jSetCss({transition:""}),this.node.jSetCss({transform:"scale(0.6)"}).jGetSize(),this.node.jSetCss({transition:m.browser.cssTransform+" 0.4s cubic-bezier(0.175, 0.885, 0.320, 1) 0s"}),m.browser.features.transition?(this.node.jAddEvent("transitionend",this.onExpand),!m.browser.chrome||"chrome"!==m.browser.uaName&&"opera"!==m.browser.uaName||setTimeout(c(function(){this.onExpand()}).jBind(this),500)):this.onExpand.jDelay(16,this),this.expandBox.jSetCss({opacity:1}),this.node.jSetCss({transform:"scale(1)"})},openLink:function(){this.image.link&&window.open(this.image.link,"_self")},getNext:function(){var t=(this.expanded?this.expandGallery:this.additionalImages).filter(function(t){return-1!==t.small.state||-1!==t.zoom.state}),e=t.length,i=c(t).indexOf(this.image)+1;return 1>=e?null:t[i>=e?0:i]},getPrev:function(){var t=(this.expanded?this.expandGallery:this.additionalImages).filter(function(t){return-1!==t.small.state||-1!==t.zoom.state}),e=t.length,i=c(t).indexOf(this.image)-1;return 1>=e?null:t[0>i?e-1:i]},imageByURL:function(t,e){var i=this.additionalImages.filter(function(i){return(i.zoom.src.has(t)||i.zoom.url.has(t))&&(i.small.src.has(e)||i.small.url.has(e))})||[];return i[0]||(e&&t&&"string"===m.jTypeOf(e)&&"string"===m.jTypeOf(t)?new O(e,t):null)},imageByOrigin:function(t){
var e=this.additionalImages.filter(function(e){return e.origin===t})||[];return e[0]},imageByIndex:function(t){return this.additionalImages[t]}},p={version:"v5.2.2 (Plus) DEMO",start:function(t,i){var o=null,n=[];return m.$A(t?[c(t)]:m.$A(document.byClass("MagicZoom")).concat(m.$A(document.byClass("MagicZoomPlus")))).jEach(c(function(t){c(t)&&(e(t)||(o=new R(t,i),E&&!o.option("autostart")?(o.stop(),o=null):(C.push(o),n.push(o))))}).jBind(this)),t?n[0]:n},stop:function(t){var i,o;if(t)return void((o=e(t))&&(o=C.splice(C.indexOf(o),1))&&o[0].stop()&&delete o[0]);for(;i=C.length;)o=C.splice(i-1,1),o[0].stop(),delete o[0]},refresh:function(t){return this.stop(t),this.start(t)},update:function(t,i,o,n){var s,a=e(t);a&&(s="element"===m.jTypeOf(i)?a.imageByOrigin(i):a.imageByURL(i,o),s&&a.update(s))},switchTo:function(t,i){var o,n=e(t);if(n){switch(m.jTypeOf(i)){case"element":o=n.imageByOrigin(i);break;case"number":o=n.imageByIndex(i)}o&&n.update(o)}},prev:function(t){var i;(i=e(t))&&i.update(i.getPrev())},next:function(t){var i;(i=e(t))&&i.update(i.getNext())},zoomIn:function(t){var i;(i=e(t))&&i.activate()},zoomOut:function(t){var i;(i=e(t))&&i.deactivate()},expand:function(t){var i;(i=e(t))&&i.expand()},close:function(t){var i;(i=e(t))&&i.close()},registerCallback:function(t,e){y[t]||(y[t]=[]),"function"===m.jTypeOf(e)&&y[t].push(e)},running:function(t){return!!e(t)}},c(document).jAddEvent("domready",function(){var t=window[w+"Options"]||{};k=k(),d(),g=m.$new("div",{"class":"magic-hidden-wrapper"}).jAppendTo(document.body),f=m.browser.mobile&&window.matchMedia&&window.matchMedia("(max-device-width: 767px), (max-device-height: 767px)").matches,m.browser.mobile&&m.extend(v,x);for(var e=0;e<z.length;e++)t[z[e]]&&m.$F!==t[z[e]]&&p.registerCallback(z[e],t[z[e]]);p.start(),E=!1}),window.MagicZoomPlus=window.MagicZoomPlus||{},p}();